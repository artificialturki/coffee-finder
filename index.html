<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>â˜• Coffee Finder Pro â€” Ultimate Free Edition</title>

  <!-- Ù…ÙƒØªØ¨Ø§Øª -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
  <link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet">

  <style>
    :root {
      --primary: #734f35;
      --neon-blue: #18dcff;
      --neon-pink: #ff4d8d;
      --warning: #ffd166;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #0a0e17;
      color: #eee;
      overflow-x: hidden;
    }
    header {
      background: linear-gradient(135deg, #734f35, #8B4513);
      color: white;
      padding: 20px;
      border-radius: 12px;
      margin: 20px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    .brand {
      font-size: 2rem;
      font-weight: bold;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }
    .brand i { color: var(--neon-blue); text-shadow: 0 0 5px var(--neon-blue); }

    /* Ø¨Ø®Ø§Ø± Ø§Ù„Ù‚Ù‡ÙˆØ© */
    .coffee-steam { position: relative; display: inline-block; }
    .steam {
      position: absolute; width: 15px; height: 15px;
      border-radius: 50%; background: rgba(255,255,255,0.6);
      animation: rise 4s ease-in-out infinite;
      opacity: 0;
    }
    .steam.one { left: -10px; animation-delay: 0s; }
    .steam.two { left: 0px; animation-delay: 1s; }
    .steam.three { left: 10px; animation-delay: 2s; }
    @keyframes rise {
      0% { transform: translateY(0) scale(0.4); opacity: 0.7; }
      100% { transform: translateY(-60px) scale(1.2); opacity: 0; }
    }

    #map { height: 500px; border-radius: 12px; margin: 20px 0; }

    .cafe-card {
      background: #131c2f;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      transition: transform 0.3s;
    }
    .cafe-card:hover { transform: translateY(-5px); border:1px solid var(--neon-blue); }
    .cafe-card h5 { margin-bottom: 8px; }

    /* Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
    .notification {
      position: fixed; top: 20px; right: 20px;
      background: linear-gradient(135deg, var(--neon-blue), var(--neon-pink));
      color: white; padding: 12px 18px; border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
      opacity: 0; transform: translateX(100%);
      transition: all 0.5s;
      z-index: 1000;
    }
    .notification.show { opacity: 1; transform: translateX(0); }

    /* Chatbot */
    .chatbot-toggle {
      position: fixed; bottom: 25px; left: 25px;
      width: 60px; height: 60px; border-radius: 50%;
      border: none; cursor: pointer;
      background: linear-gradient(135deg, var(--neon-pink), #7158e2);
      color: white; font-size: 22px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    }
    .chatbot-window {
      position: fixed; bottom: 100px; left: 25px;
      width: 320px; height: 420px; background: #131c2f;
      border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      display: none; flex-direction: column; overflow: hidden;
    }
    .chatbot-messages { flex:1; padding:10px; overflow-y:auto; }
    .chatbot-input { display:flex; gap:5px; padding:10px; }
    .chatbot-input input { flex:1; border-radius:20px; border:none; padding:8px; }
  </style>
</head>
<body>

<header>
  <div class="brand">
    <i class="fas fa-mug-hot"></i> Coffee Finder Pro
    <div class="coffee-steam">
      <div class="steam one"></div>
      <div class="steam two"></div>
      <div class="steam three"></div>
    </div>
  </div>
  <div class="input-group mt-3">
    <input type="text" id="searchInput" class="form-control" placeholder="Search city in Saudi Arabia...">
    <button class="btn btn-warning" id="searchBtn"><i class="fas fa-search"></i></button>
  </div>
  <div class="mt-2">
    <label>Radius:</label>
    <select id="radius">
      <option value="1000">1 km</option>
      <option value="3000" selected>3 km</option>
      <option value="5000">5 km</option>
      <option value="10000">10 km</option>
    </select>
  </div>
</header>

<div class="container">
  <div id="map"></div>
  <h4>Results</h4>
  <div id="cafeList"></div>
</div>

<!-- Ø¥Ø´Ø¹Ø§Ø± -->
<div id="notification" class="notification"></div>

<!-- Chatbot -->
<button class="chatbot-toggle" id="chatbotToggle"><i class="fas fa-robot"></i></button>
<div class="chatbot-window" id="chatbotWindow">
  <div class="chatbot-messages" id="chatbotMessages">
    <div class="text-light">ðŸ¤– Hello! I can help you find cafes. Type a city name.</div>
  </div>
  <div class="chatbot-input">
    <input type="text" id="chatbotInput" placeholder="Ask me...">
    <button id="sendMessage" class="btn btn-sm btn-primary"><i class="fas fa-paper-plane"></i></button>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
let map = L.map('map').setView([24.7136, 46.6753], 12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OSM contributors'
}).addTo(map);

// Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
function showNotification(msg) {
  const note = document.getElementById("notification");
  note.textContent = msg;
  note.classList.add("show");
  setTimeout(()=>note.classList.remove("show"),3000);
}

// Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© (Nominatim)
async function searchCity(query) {
  const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query + ", Saudi Arabia")}`;
  const res = await fetch(url); const results = await res.json();
  if(results.length>0) {
    const {lat,lon} = results[0];
    map.setView([lat,lon],13);
    fetchCafes(lat, lon, document.getElementById("radius").value);
    showNotification("âœ… Found city: "+results[0].display_name);
  } else showNotification("âŒ City not found");
}

// Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù‚Ø§Ù‡ÙŠ Ù…Ù† OSM (Overpass)
async function fetchCafes(lat, lon, radius) {
  const url = `https://overpass-api.de/api/interpreter?data=[out:json];node["amenity"="cafe"](around:${radius},${lat},${lon});out;`;
  const res = await fetch(url); const data = await res.json();
  renderCafeList(data.elements);
}

// Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
function renderCafeList(cafes) {
  const list = document.getElementById("cafeList");
  list.innerHTML = "";
  cafes.forEach((cafe,i)=>{
    const name = cafe.tags.name || "Unnamed Cafe";
    const addr = cafe.tags["addr:street"] || "No Address";
    const div = document.createElement("div");
    div.className="cafe-card"; div.style.opacity=0;
    div.innerHTML = `
      <h5>â˜• ${name}</h5>
      <p><i class="fas fa-map-marker-alt"></i> ${addr}</p>
      <button class="btn btn-sm btn-outline-light" onclick="openInMaps(${cafe.lat},${cafe.lon})"><i class="fas fa-route"></i> Directions</button>
      <button class="btn btn-sm btn-outline-danger" onclick="addFavorite('${name}')"><i class="fas fa-heart"></i> Favorite</button>
    `;
    list.appendChild(div);
    setTimeout(()=>{div.style.opacity=1;}, i*100);
    // Marker
    const marker = L.marker([cafe.lat,cafe.lon]).addTo(map);
    marker.bindPopup(`<b>${name}</b><br>${addr}`);
  });
}

// ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙŠ Google Maps
function openInMaps(lat,lon){
  window.open(`https://www.google.com/maps/dir/?api=1&destination=${lat},${lon}`,"_blank");
}

// Ø§Ù„Ù…ÙØ¶Ù„Ø©
function addFavorite(name){
  let favs = JSON.parse(localStorage.getItem("favorites")||"[]");
  favs.push(name); localStorage.setItem("favorites",JSON.stringify(favs));
  showNotification("â¤ï¸ Added to favorites: "+name);
}

// Events
document.getElementById("searchBtn").addEventListener("click",()=>searchCity(document.getElementById("searchInput").value));
document.getElementById("searchInput").addEventListener("keypress",e=>{if(e.key==="Enter") searchCity(e.target.value);});

// Chatbot
document.getElementById("chatbotToggle").addEventListener("click",()=>{
  const w=document.getElementById("chatbotWindow");
  w.style.display=w.style.display==="flex"?"none":"flex";
});
document.getElementById("sendMessage").addEventListener("click",()=>{
  const input=document.getElementById("chatbotInput");
  if(input.value.trim()){
    addChatMessage(input.value,"user");
    setTimeout(()=>addChatMessage("ðŸ¤– Searching for: "+input.value,"bot"),800);
    searchCity(input.value);
    input.value="";
  }
});
function addChatMessage(text,sender){
  const msg=document.createElement("div");
  msg.textContent=text; msg.style.padding="5px"; msg.style.borderRadius="8px";
  msg.style.margin="5px 0"; msg.style.background=sender==="user"?"#18dcff":"#7158e2";
  msg.style.color="white"; msg.style.alignSelf=sender==="user"?"flex-end":"flex-start";
  document.getElementById("chatbotMessages").appendChild(msg);
}
fetchCafes(24.7136, 46.6753, 3000); // Load default (Riyadh)
</script>
</body>
</html>
