<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‚òï Coffee Finder Pro ‚Äî Sci-Fi Edition</title>

  <!-- ŸÖŸÉÿ™ÿ®ÿßÿ™ ÿÆÿßÿ±ÿ¨Ÿäÿ© -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet" />
  <link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet" />

  <style>

    <!-- === Leaflet CSS/JS === -->
<link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
/* ============================
   üó∫Ô∏è MAP CORE ‚Äî Leaflet Setup
============================ */
let map, cafesLayer;
*{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      overflow-x: hidden;
      background-image:
        radial-gradient(circle at 15% 50%, rgba(24,220,255,0.08) 0%, transparent 25%),
        radial-gradient(circle at 85% 30%, rgba(113,88,226,0.08) 0%, transparent 25%),
        radial-gradient(circle at 50% 80%, rgba(255,77,141,0.06) 0%, transparent 25%);
    }

    /* Themes (light/dark/space/neon) */
    [data-theme="light"]{
      --bg-primary:#f8f9fa; --bg-secondary:#ffffff;
      --text-primary:#212529; --text-secondary:#495057;
      --card-bg:#ffffff; --border-color:#dee2e6;
      --header-bg: linear-gradient(135deg, #734f35, #8b4513);
    }
    [data-theme="dark"]{
      --bg-primary:#0a1929; --bg-secondary:#0f253d;
      --text-primary:#e9ecef; --text-secondary:#adb5bd;
      --card-bg:#132238; --border-color:#2a3e5a;
      --header-bg: linear-gradient(135deg, #132238, #1e3a5f);
    }
    [data-theme="space"]{
      --bg-primary:#0a0e17; --bg-secondary:#0f1525;
      --text-primary:#e9ecef; --text-secondary:#8b9bb4;
      --card-bg:#131c2f; --border-color:#24334d;
      --header-bg: linear-gradient(135deg, #131c2f, #1e2f4f);
    }
    [data-theme="neon"]{
      --bg-primary:#0a0a0a; --bg-secondary:#111;
      --text-primary:#18dcff; --text-secondary:#ff4d8d;
      --card-bg:#1a1a1a; --border-color:#333;
      --header-bg: linear-gradient(135deg, #18dcff, #7158e2);
    }

    /* =============================
       üåü Header with steaming cup
    ============================== */
    header.site-header{
      background: var(--header-bg);
      padding: 20px;
      border-radius: 16px;
      margin: 16px auto 14px;
      max-width: 1400px;
      color: white;
      position:relative;
      overflow:hidden;
      box-shadow: var(--shadow);
      border: 2px solid transparent;
      background-clip: padding-box;
    }
    header.site-header::after{
      content:''; position:absolute; inset:-2px;
      z-index:-1; border-radius:18px;
      background: linear-gradient(90deg,var(--neon-blue),var(--neon-pink),var(--cyber-yellow));
      animation: borderflow 8s linear infinite; background-size:300% 300%;
    }
    @keyframes borderflow{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}

    .brand{
      display:flex; align-items:center; justify-content:center; gap:14px;
      font-weight:900; font-size:2.2rem; letter-spacing:.3px;
    }
    .brand i{ color:var(--neon-blue); filter: drop-shadow(0 0 6px var(--neon-blue)); }

    .coffee-steam{ display:inline-block; position:relative; width:24px; height:24px; }
    .steam-bubble{
      position:absolute; width:16px; height:16px; border-radius:50%;
      background: radial-gradient(circle at 50% 30%, rgba(255,255,255,.85), rgba(255,255,255,.05));
      left:4px; opacity:0;
    }
    .steam-bubble.one{ animation: steamUp 4s ease-out infinite; }
    .steam-bubble.two{ animation: steamUp 4s ease-out 1s infinite; }
    .steam-bubble.three{ animation: steamUp 4s ease-out 2s infinite; }
    @keyframes steamUp{
      0%{ transform:translateY(10px) scale(.4); opacity:.65; }
      100%{ transform: translate(-8px, -50px) scale(1.4); opacity:0; }
    }

    /* =============================
       üîç Search panel + filters
    ============================== */
    .search-panel{
      background:var(--card-bg);
      border:1px solid var(--border-color);
      border-radius:16px; padding:18px;
      margin: 10px auto 14px; max-width:1200px;
      box-shadow: var(--shadow);
    }
    .search-row{ display:flex; gap:10px; flex-wrap:wrap; }
    .search-row input[type="text"]{
      flex:1; padding:12px 16px; border-radius:10px; border:1px solid var(--border-color);
      background: var(--bg-secondary); color: var(--text-primary);
    }
    .btn-search{
      background: linear-gradient(135deg, var(--neon-blue), var(--space-purple));
      color:white; border:none; font-weight:800; padding:12px 18px; border-radius:10px; white-space:nowrap;
    }
    .filters{ display:flex; flex-wrap:wrap; gap:10px; margin-top:12px; }
    .chip{
      display:inline-flex; align-items:center; gap:6px; padding:8px 12px; border-radius:20px;
      background:var(--bg-secondary); border:1px solid var(--border-color); font-size:.95rem;
    }

    /* =============================
       üó∫Ô∏è Map container (fixed on top of page)
    ============================== */
    .map-wrap{
      margin: 12px auto 18px; max-width:1200px;
      border-radius:16px; overflow:hidden; border:1px solid var(--border-color);
      box-shadow: var(--shadow);
      height: 560px;
    }
    #map{ width:100%; height:100%; }

    /* Custom cup marker (white cup + brown coffee + animated steam) */
    .cup-marker{ position:relative; width:34px; height:34px; transform: translate(-17px,-28px); }
    .cup-marker .cup-body{
      position:absolute; left:3px; bottom:2px; width:28px; height:18px; border-radius:0 0 8px 8px;
      background:#fff; border:2px solid #eee;
      box-shadow:0 2px 6px rgba(0,0,0,.25) inset;
    }
    .cup-marker .coffee{
      position:absolute; left:5px; bottom:14px; width:24px; height:6px; background:#5d4037; border-radius:6px 6px 0 0;
    }
    .cup-marker .cup-handle{
      position:absolute; right:-3px; bottom:8px; width:10px; height:10px; border-radius:50%;
      border:3px solid #fff; border-left-color:transparent; border-bottom-color:transparent; transform:rotate(20deg);
    }
    .cup-marker .steam{ position:absolute; left:12px; bottom:22px; width:6px; height:6px; border-radius:50%;
      background: radial-gradient(circle at 50% 30%, rgba(255,255,255,.95), rgba(255,255,255,.15));
      filter: blur(.2px); opacity:0; animation: puff 3.6s ease-out infinite;
    }
    .cup-marker .steam.s2{ left:16px; animation-delay: .8s; }
    .cup-marker .steam.s3{ left:9px;  animation-delay: 1.6s; }
    @keyframes puff{
      0%{ transform: translateY(0) scale(.4); opacity:.8; }
      100%{ transform: translate(-3px, -20px) scale(1.4); opacity:0; }
    }

    /* =============================
       üé¥ Cafe cards
    ============================== */
    .results-section{ max-width:1200px; margin: 6px auto 40px; }
    .results-header{ background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:12px 16px; }
    .cafe-grid{ display:grid; grid-template-columns:repeat(auto-fill, minmax(320px,1fr)); gap:22px; margin-top:18px; }
    .cafe-card{
      background:var(--card-bg); border:1px solid var(--border-color); border-radius:16px; overflow:hidden;
      box-shadow: var(--shadow); transform: translateY(20px); opacity:0; transition:.6s;
    }
    .cafe-card.show{ transform:translateY(0); opacity:1; }
    .cafe-cover{ height:190px; background:linear-gradient(135deg,#d7ccc8,#5d4037); display:flex; align-items:center; justify-content:center; overflow:hidden; }
    .cafe-cover img{ width:100%; height:100%; object-fit:cover; transition: transform .5s ease; }
    .cafe-card:hover .cafe-cover img{ transform:scale(1.08); }
    .cafe-body{ padding:16px; }
    .cafe-title{ display:flex; align-items:center; justify-content:space-between; gap:10px; font-weight:800; font-size:1.2rem; color:var(--text-primary); }
    .cafe-meta{ display:flex; gap:12px; flex-wrap:wrap; font-size:.95rem; color:var(--text-secondary); margin:10px 0; }
    .tag{ display:inline-flex; align-items:center; gap:6px; padding:5px 10px; border-radius:12px; border:1px solid rgba(255,255,255,.2); font-size:.85rem; }
    .tag.wifi{ background:rgba(24,220,255,.15); color:var(--neon-blue); }
    .tag.outdoor{ background:rgba(255,209,102,.15); color:var(--warning); }
    .tag.parking{ background:rgba(0,255,140,.15); color:var(--success); }
    .tag.snacks{ background:rgba(255,77,141,.15); color:var(--neon-pink); }
    .actions{ display:flex; gap:10px; margin-top:8px; }
    .btn-a{ flex:1; padding:10px 12px; border:none; border-radius:10px; font-weight:800; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:8px; }
    .btn-a.primary{ background: linear-gradient(135deg, var(--neon-blue), var(--space-purple)); color:white; }
    .btn-a.secondary{ background: var(--bg-secondary); border:1px solid var(--border-color); color:var(--text-primary); }
    .btn-a.heart{ background: rgba(255,77,141,.15); color: var(--neon-pink); border:1px solid rgba(255,77,141,.45); }
/* ÿ£ŸäŸÇŸàŸÜÿ© ŸÉŸàÿ® ÿ£ÿ®Ÿäÿ∂ ŸÖÿπ ŸÇŸáŸàÿ© + ÿ®ÿÆÿßÿ± (SVG ŸÖÿ∂ŸÖŸëŸÜ) */
function makeCoffeeIcon() {
  const svg = `
  <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64">
    <defs>
      <filter id="s" x="-50%" y="-50%" width="200%" height="200%">
        <feGaussianBlur in="SourceGraphic" stdDeviation="0.8"/>
      </filter>
    </defs>
    <!-- ÿ®ÿÆÿßÿ± -->
    <path d="M25 12c0-4 6-4 6-8" stroke="#18dcff" stroke-width="2" fill="none" filter="url(#s)"/>
    <path d="M33 14c0-4 6-4 6-8" stroke="#18dcff" stroke-width="2" fill="none" filter="url(#s)"/>
    <!-- ŸÉŸàÿ® -->
    <rect x="10" y="22" rx="6" ry="6" width="36" height="26" fill="#ffffff" stroke="#e8e8e8" stroke-width="2"/>
    <!-- ŸäÿØ ÿßŸÑŸÉŸàÿ® -->
    <path d="M46 26c8 0 8 12 0 12" fill="none" stroke="#ffffff" stroke-width="6"/>
    <path d="M46 27.5c6 0 6 9 0 9" fill="none" stroke="#cfcfcf" stroke-width="2"/>
    <!-- ÿ≥ÿ∑ÿ≠ ÿßŸÑŸÇŸáŸàÿ© -->
    <ellipse cx="28" cy="28" rx="16" ry="5" fill="#6f4e37"/>
    <!-- ŸÇÿßÿπÿØÿ© -->
    <rect x="16" y="48" width="24" height="3" rx="2" fill="#dcdcdc"/>
    <!-- ÿ∏ŸÑ -->
    <ellipse cx="32" cy="58" rx="18" ry="3" fill="rgba(0,0,0,0.2)"/>
  </svg>`;
  return L.icon({
    iconUrl: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(svg),
    iconSize: [36, 44],
    iconAnchor: [18, 42],
    popupAnchor: [0, -36],
    className: 'coffee-marker'
  });
}
const coffeeIcon = makeCoffeeIcon();

function initMap() {
  // ÿ£ŸÜÿ¥ÿ¶ ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ©
  map = L.map('map', { zoomControl: false, minZoom: 3 }).setView([24.7136, 46.6753], 12);

  // ÿ∑ÿ®ŸÇÿßÿ™ ÿ£ÿ≥ÿßÿ≥ (ŸÖÿπ ÿ™ÿ®ÿØŸäŸÑ)
  const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '¬© OpenStreetMap'
  }).addTo(map);

  const cartoDark = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; Carto'
  });

  L.control.layers(
    { 'OSM': osm, 'Carto Dark': cartoDark },
    {},
    { position: 'topleft' }
  ).addTo(map);

  // ÿ£ÿ≤ÿ±ÿßÿ± ÿ™ŸÉÿ®Ÿäÿ±/ÿ™ÿµÿ∫Ÿäÿ± ÿ£ÿ≥ŸÅŸÑ ŸäŸÖŸäŸÜ
  L.control.zoom({ position: 'bottomright' }).addTo(map);

  // ÿ∑ÿ®ŸÇÿ© ÿßŸÑŸÖŸÇÿßŸáŸä
  cafesLayer = L.layerGroup().addTo(map);

  // ŸÉŸÜÿ™ÿ±ŸàŸÑ "ÿ®ÿßŸÑŸÇÿ±ÿ® ŸÖŸÜŸä"
  addNearbyControl();

  // ŸÖÿπÿßŸÑÿ¨ÿ© ÿπÿØŸÖ ÿ∏ŸáŸàÿ± ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ© ÿπŸÜÿØ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ŸàŸÑ
  setTimeout(() => map.invalidateSize(), 300);

  // ÿ£ÿ±ÿ®ÿ∑ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑÿÆÿßÿ±ÿ¨Ÿäÿ© ÿßŸÑŸÖŸàÿ¨ŸàÿØÿ© ÿπŸÜÿØŸÉ
  const btn = document.getElementById('searchBtn');
  const input = document.getElementById('searchInput');
  if (btn && input) {
    btn.addEventListener('click', () => {
      const q = input.value.trim();
      if (q) searchCity(q);
    });
    input.addEventListener('keypress', e => {
      if (e.key === 'Enter') {
        const q = input.value.trim();
        if (q) searchCity(q);
      }
    });
  }

  // ÿ≤ÿ± ÿÆÿßÿ±ÿ¨Ÿä "ÿ®ÿßŸÑŸÇÿ±ÿ® ŸÖŸÜŸä"
  const nearbyBtn = document.getElementById('nearbyBtn');
  if (nearbyBtn) nearbyBtn.addEventListener('click', goNearby);
}

// ŸÉŸÜÿ™ÿ±ŸàŸÑ ÿ≤ÿ± "ÿ®ÿßŸÑŸÇÿ±ÿ® ŸÖŸÜŸä"
function addNearbyControl() {
  const NearMe = L.Control.extend({
    position: 'topright',
    onAdd: function () {
      const btn = L.DomUtil.create('button', '');
      btn.innerHTML = 'üìç Near Me';
      btn.title = 'ÿßÿ®ÿ≠ÿ´ ÿ≠ŸàŸÑ ŸÖŸàŸÇÿπŸä';
      btn.style.cssText = 'background:#fff;padding:6px 10px;border:1px solid #ddd;border-radius:8px;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,.2);';
      L.DomEvent.on(btn, 'click', function (e) {
        L.DomEvent.stopPropagation(e);
        goNearby();
      });
      return btn;
    }
  });
  map.addControl(new NearMe());
}

// ÿ™ŸÜŸÅŸäÿ∞ ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖŸàŸÇÿπ ÿ´ŸÖ ÿ¨ŸÑÿ® ÿßŸÑŸÖŸÇÿßŸáŸä
function goNearby() {
  if (!navigator.geolocation) {
    showNotification && showNotification('ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ ŸÑÿß ŸäÿØÿπŸÖ ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖŸàŸÇÿπ', 'error');
    return;
  }
  navigator.geolocation.getCurrentPosition(pos => {
    const { latitude, longitude } = pos.coords;
    map.setView([latitude, longitude], 14);
    L.circle([latitude, longitude], { radius: 60, color: '#18dcff', fillColor: '#18dcff', fillOpacity: .2 }).addTo(map);
    const r = document.getElementById('radius')?.value || 3000;
    fetchCafes(latitude, longitude, r);
  }, () => {
    showNotification && showNotification('ÿ™ÿπÿ∞Ÿëÿ± ÿ™ÿ≠ÿØŸäÿØ ŸÖŸàŸÇÿπŸÉ', 'error');
  }, { enableHighAccuracy: true, timeout: 8000 });
}
<!-- Search Panel -->
  <section class="search-panel">
    <div class="search-row">
      <input id="searchInput" type="text" placeholder="Search for a city in Saudi Arabia..." data-i18n-placeholder="searchPlaceholder">
      <button class="btn-search" id="searchBtn"><i class="fas fa-search"></i> <span data-i18n="search">Search</span></button>
    </div>
    <div class="filters">
      <label class="chip"><input type="checkbox" id="wifi"> <span data-i18n="wifi">Wi‚ÄëFi</span></label>
      <label class="chip"><input type="checkbox" id="outdoor"> <span data-i18n="outdoor">Outdoor</span></label>
      <label class="chip"><input type="checkbox" id="parking"> <span data-i18n="parking">Parking</span></label>
      <label class="chip"><input type="checkbox" id="openNow"> <span data-i18n="openNow">Open Now</span></label>
      <label class="chip" style="gap:8px;">
        <span data-i18n="radius">Radius</span>:
        <select id="radius">
          <option value="1000">1 km</option>
          <option value="3000" selected>3 km</option>
          <option value="5000">5 km</option>
          <option value="10000">10 km</option>
        </select>
      </label>
    </div>
  </section>

  <!-- Map -->
  <section class="map-wrap">
    <div id="map"></div>
  </section>

  <!-- Results -->
  <section class="results-section">
    <div class="results-header d-flex justify-content-between align-items-center">
      <h2 class="m-0" style="font-size:1.15rem;">
        <span data-i18n="found">Found</span> <span id="resultsNumber">0</span> <span data-i18n="shops">coffee shops</span>
      </h2>
      <select id="sortSelect" class="form-select form-select-sm" style="max-width:200px;">
        <option value="distance" data-i18n="closest">Closest First</option>
        <option value="rating" data-i18n="highest">Highest Rated</option>
        <option value="name" data-i18n="byname">By Name</option>
      </select>
    </div>
    <div id="cafeList" class="cafe-grid"></div>
  </section>

  <!-- Notifications -->
  <div id="notifications"></div>

  <!-- Advertisement & Contact -->
  <section id="ads" class="container" style="max-width:1100px; margin: 20px auto 40px;">
    <div class="row g-3">
      <div class="col-md-6">
        <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:16px; padding:18px; box-shadow:var(--shadow);">
          <h3 style="color:var(--neon-blue); margin-bottom:8px;" data-i18n="adtitle">üì¢ Advertise your caf√©</h3>
          <p style="color:var(--text-secondary);" data-i18n="adtext">Promote your coffee shop to thousands of seekers nearby. Beautiful banners, premium placement and fair pricing.</p>
          <button id="openContact" class="btn btn-sm" style="background:linear-gradient(135deg,var(--neon-blue),var(--space-purple)); color:white; border:none; border-radius:10px; padding:10px 16px;" data-i18n="contact">Contact us</button>
        </div>
      </div>
      <div class="col-md-6">
        <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:16px; padding:18px; box-shadow:var(--shadow);">
          <h3 style="color:var(--neon-pink); margin-bottom:8px;" data-i18n="featuredt">üåü Featured slots</h3>
          <p style="color:var(--text-secondary);" data-i18n="featuredd">Get highlighted on map and results for more visibility. Slots are limited.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Contact Modal -->
  <div id="contactModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.75); z-index:4200; align-items:center; justify-content:center;">
    <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:16px; padding:22px; width:min(92%,520px); box-shadow:var(--shadow); position:relative;">
      <button id="closeContact" style="position:absolute; right:12px; top:10px; background:none; border:none; color:var(--text-secondary); font-size:22px;">√ó</button>
      <h4 style="margin-bottom:10px;" data-i18n="contact">Contact us</h4>
      <p style="margin:0 0 8px;"><b>WhatsApp:</b> <a href="https://wa.me/966500000000" target="_blank" style="color:var(--neon-green)">+966 50 000 0000</a></p>
      <p style="margin:0 0 14px;"><b>Email:</b> <a href="mailto:ads@coffeefinder.sa" style="color:var(--neon-blue)">ads@coffeefinder.sa</a></p>
      <form id="adForm">
        <input id="adName" type="text" placeholder="Your Name" required class="form-control mb-2" />
        <textarea id="adMsg" rows="4" placeholder="Your message..." required class="form-control mb-3"></textarea>
        <button class="btn btn-primary" style="background:linear-gradient(135deg,var(--neon-blue),var(--space-purple)); border:none;" data-i18n="send">Send</button>
      </form>
    </div>
  </div>

  <!-- Footer -->
  <footer class="site-footer">
    <h3 style="margin:0 0 8px;">üì≤ <span data-i18n="getapp">Get the Coffee Finder Pro App</span></h3>
    <div style="display:flex; gap:16px; justify-content:center; flex-wrap:wrap; margin:14px 0 4px;">
      <a href="#" class="btn btn-dark" style="display:flex; align-items:center; gap:10px; border-radius:12px; padding:10px 16px;">
        <i class="fab fa-apple fa-2x"></i><div style="text-align:left;"><small>Download on the</small><br><b>App Store</b></div>
      </a>
      <a href="#" class="btn" style="background:#2ecc71; color:white; display:flex; align-items:center; gap:10px; border-radius:12px; padding:10px 16px;">
        <i class="fab fa-google-play fa-2x"></i><div style="text-align:left;"><small>Get it on</small><br><b>Google Play</b></div>
      </a>
    </div>

    <div class="footer-social">
      <a href="https://twitter.com" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
      <a href="https://facebook.com" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
      <a href="https://instagram.com" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
      <!-- GitHub intentionally removed per request -->
    </div>
    <p style="margin:8px 0 2px;">¬© 2025 Coffee Finder Pro ‚Äî <span data-i18n="rights">All Rights Reserved</span></p>
    <p style="margin:0;">‚òï <span data-i18n="made">Made with love in Saudi Arabia</span></p>
    <div style="margin-top:6px; display:flex; gap:14px; justify-content:center; flex-wrap:wrap;">
      <a href="#" style="color:#cce7ff; text-decoration:none;" data-i18n="privacy">Privacy</a>
      <a href="#" style="color:#cce7ff; text-decoration:none;" data-i18n="terms">Terms</a>
      <a href="#" style="color:#cce7ff; text-decoration:none;" data-i18n="contact">Contact</a>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
  // =============================
  // i18n (Arabic/English)
  // =============================
  const i18n = {
    en: {
      title: "Coffee Finder Pro",
      search: "Search",
      searchPlaceholder: "Search for a city in Saudi Arabia...",
      wifi: "Wi‚ÄëFi", outdoor:"Outdoor", parking:"Parking", openNow:"Open Now", radius:"Radius",
      found: "Found", shops:"coffee shops", closest:"Closest First", highest:"Highest Rated", byname:"By Name",
      adtitle:"üì¢ Advertise your caf√©", adtext:"Promote your coffee shop to thousands of seekers nearby. Beautiful banners, premium placement and fair pricing.",
      contact:"Contact us", featuredt:"üåü Featured slots", featuredd:"Get highlighted on map and results for more visibility. Slots are limited.",
      send:"Send", getapp:"Get the Coffee Finder Pro App", rights:"All Rights Reserved", made:"Made with ‚ù§Ô∏è in Saudi Arabia",
      privacy:"Privacy", terms:"Terms", near:"Nearby"
    },
    ar: {
      title: "ŸÉŸàŸÅŸä ŸÅÿßŸäŸÜÿØÿ± ÿ®ÿ±Ÿà",
      search: "ÿ®ÿ≠ÿ´",
      searchPlaceholder: "ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖÿØŸäŸÜÿ© ÿØÿßÿÆŸÑ ÿßŸÑÿ≥ÿπŸàÿØŸäÿ©...",
      wifi:"ŸàÿßŸä ŸÅÿßŸä", outdoor:"ÿ¨ŸÑÿ≥ÿßÿ™ ÿÆÿßÿ±ÿ¨Ÿäÿ©", parking:"ŸÖŸàÿßŸÇŸÅ", openNow:"ŸÖŸÅÿ™Ÿàÿ≠ ÿßŸÑÿ¢ŸÜ", radius:"ŸÜÿ∑ÿßŸÇ",
      found:"ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ", shops:"ŸÖŸÇÿßŸáŸä", closest:"ÿßŸÑÿ£ŸÇÿ±ÿ® ÿ£ŸàŸÑÿßŸã", highest:"ÿßŸÑÿ£ÿπŸÑŸâ ÿ™ŸÇŸäŸäŸÖÿßŸã", byname:"ÿ≠ÿ≥ÿ® ÿßŸÑÿßÿ≥ŸÖ",
      adtitle:"üì¢ ÿ£ÿπŸÑŸÜ ÿπŸÜ ŸÖŸÇŸáÿßŸÉ", adtext:"ÿ±ŸàŸëÿ¨ ŸÑŸÖŸÇŸáŸâŸÉ ŸÑÿ¢ŸÑÿßŸÅ ÿßŸÑÿ®ÿßÿ≠ÿ´ŸäŸÜ ÿßŸÑŸÇÿ±Ÿäÿ®ŸäŸÜ. ÿ®ŸÜÿ±ÿßÿ™ ÿ¨ÿ∞ÿßÿ®ÿ© ŸàŸÖŸÉÿßŸÜÿ© ŸÖŸÖŸäÿ≤ÿ© Ÿàÿ≥ÿπÿ± ÿπÿßÿØŸÑ.",
      contact:"ÿ±ÿßÿ≥ŸÑŸÜÿß", featuredt:"üåü ŸÖÿ≥ÿßÿ≠ÿßÿ™ ŸÖŸÖŸäÿ≤ÿ©", featuredd:"ÿßÿ≠ÿµŸÑ ÿπŸÑŸâ ÿ•ÿ®ÿ±ÿßÿ≤ ŸÅŸä ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ© ŸàÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ŸÑÿ≤ŸäÿßÿØÿ© ÿßŸÑÿ∏ŸáŸàÿ±. ÿßŸÑÿ£ŸÖÿßŸÉŸÜ ŸÖÿ≠ÿØŸàÿØÿ©.",
      send:"ÿ•ÿ±ÿ≥ÿßŸÑ", getapp:"ÿ≠ŸÖŸëŸÑ ÿ™ÿ∑ÿ®ŸäŸÇ ŸÉŸàŸÅŸä ŸÅÿßŸäŸÜÿØÿ± ÿ®ÿ±Ÿà", rights:"ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©", made:"ÿµŸèŸÜÿπ ÿ®ÿ≠ÿ® ŸÅŸä ÿßŸÑÿ≥ÿπŸàÿØŸäÿ©",
      privacy:"ÿßŸÑÿÆÿµŸàÿµŸäÿ©", terms:"ÿßŸÑÿ¥ÿ±Ÿàÿ∑", near:"ÿ®ÿßŸÑŸÇÿ±ÿ® ŸÖŸÜŸä"
    }
  };
  let lang = "en";
  function applyI18n(){
    const dict = i18n[lang];
    document.querySelectorAll("[data-i18n]").forEach(el=>{ el.textContent = dict[el.getAttribute("data-i18n")] || el.textContent; });
    document.querySelectorAll("[data-i18n-placeholder]").forEach(el=>{ el.setAttribute("placeholder", dict[el.getAttribute("data-i18n-placeholder")] || el.getAttribute("placeholder")); });
    document.body.dir = (lang==="ar"?"rtl":"ltr");
    document.getElementById("langToggle").textContent = (lang==="ar"?"English":"ÿßŸÑÿπÿ±ÿ®Ÿäÿ©");
  }
  document.getElementById("langToggle").addEventListener("click", ()=>{ lang = (lang==="en"?"ar":"en"); applyI18n(); showToast(lang==="ar"?"ÿ™ŸÖ ÿßŸÑÿ™ÿ®ÿØŸäŸÑ ÿ•ŸÑŸâ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©":"Language switched to English","t-info"); });
  applyI18n();

  // =============================
  // Toasts
  // =============================
  function showToast(text, cls="t-info"){
    const box = document.getElementById("notifications");
    const d = document.createElement("div");
    d.className = "toast-msg " + cls;
    d.textContent = text;
    box.appendChild(d);
    setTimeout(()=>{ d.style.opacity=.0; setTimeout(()=>d.remove(), 450); }, 3000);
  }

  // =============================
  // Scroll energy bar
  // =============================
  window.addEventListener("scroll", ()=>{
    const h=document.documentElement;
    const p= (h.scrollTop / (h.scrollHeight - h.clientHeight)) * 100;
    document.getElementById("energyBar").style.width = p + "%";
  });

  // =============================
  // Map + Nearby + Search + Cafes
  // =============================
  const map = L.map("map", { zoomControl:true, attributionControl:true }).setView([24.7136,46.6753], 12);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", { maxZoom: 19 }).addTo(map);

  // Custom "Nearby" control
  const NearbyControl = L.Control.extend({
    options:{ position:'topleft' },
    onAdd: function(){
      const btn = L.DomUtil.create('button','btn btn-sm');
      btn.style.background = 'linear-gradient(135deg, var(--neon-blue), var(--space-purple))';
      btn.style.color = 'white'; btn.style.border='none'; btn.style.padding='8px 10px'; btn.style.borderRadius='8px';
      btn.innerHTML = '<i class="fas fa-location-crosshairs"></i> ' + (i18n[lang].near);
      L.DomEvent.on(btn,'click', (e)=>{ L.DomEvent.stopPropagation(e); locateAndSearch(); });
      return btn;
    }
  });
  map.addControl(new NearbyControl());

  // Cup marker icon as DivIcon
  function createCupIcon(){
    return L.divIcon({
      className:'',
      html:`<div class="cup-marker"><div class="cup-body"></div><div class="cup-handle"></div><div class="coffee"></div><div class="steam s1"></div><div class="steam s2"></div><div class="steam s3"></div></div>`,
      iconSize:[34,34], iconAnchor:[17,28], popupAnchor:[0,-24]
    });
  }

  const cafeMarkers = L.layerGroup().addTo(map);

  async function searchCity(q){
    try{
      const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q+', Saudi Arabia')}`;
      const res = await fetch(url);
      const data = await res.json();
      if(data && data.length){
        const {lat, lon, display_name} = data[0];
        map.setView([+lat,+lon], 13);
        showToast((lang==='ar'?'ÿ™ŸÖ ÿ•Ÿäÿ¨ÿßÿØ ':'Found ') + display_name, 't-success');
        await fetchCafes(+lat,+lon);
      } else {
        showToast(lang==='ar'?'ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿßŸÑŸÖÿØŸäŸÜÿ©':'City not found','t-error');
      }
    }catch(e){ showToast('Search error','t-error'); }
  }

  async function fetchCafes(lat, lon){
    cafeMarkers.clearLayers();
    const radius = document.getElementById("radius").value || 3000;
    const overpass = "https://overpass-api.de/api/interpreter";
    const query = `[out:json];(node["amenity"="cafe"](around:${radius},${lat},${lon}););out;`;
    try{
      const r = await fetch(overpass, {method:"POST", body:query});
      const j = await r.json();
      cafes.length = 0;
      j.elements.forEach(el=>{
        const c = {
          name: el.tags.name || (lang==='ar'?'ŸÖŸÇŸáŸâ ÿ®ÿØŸàŸÜ ÿßÿ≥ŸÖ':'Unnamed Cafe'),
          address: el.tags["addr:street"] || (lang==='ar'?'ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ':'Unknown'),
          lat: el.lat, lng: el.lon,
          rating: (Math.random()*2 + 3).toFixed(1),
          distance: Math.floor(Math.random()*5)+1,
          open: Math.random() > 0.25,
          features: ["wifi","outdoor","parking","snacks"].filter(()=>Math.random()>0.55),
          image: "https://source.unsplash.com/600x400/?coffee,cafe"
        };
        cafes.push(c);
      });
      renderCafeList();
      // Add markers
      cafes.forEach(c=>{
        const m = L.marker([c.lat, c.lng], { icon:createCupIcon() }).addTo(cafeMarkers);
        m.bindPopup(`<b>${c.name}</b><br/>${c.address}<br/><small>${c.rating} ‚≠ê</small>`);
      });
      document.getElementById("resultsNumber").textContent = cafes.length;
      showToast((lang==='ar'?'ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ':'Loaded ')+cafes.length+(lang==='ar'?' ŸÖŸÇŸáŸâ':' cafes'),'t-success');
    }catch(e){
      showToast('Failed to load cafes','t-error');
    }
  }

  function locateAndSearch(){
    if(!navigator.geolocation){ showToast('Geolocation not supported','t-error'); return; }
    navigator.geolocation.getCurrentPosition((pos)=>{
      const {latitude, longitude} = pos.coords;
      map.setView([latitude, longitude], 14);
      L.circle([latitude, longitude], {radius: 80, color:'#18dcff'}).addTo(map);
      fetchCafes(latitude, longitude);
    }, ()=> showToast('Location denied','t-error'));
  }

  document.getElementById("searchBtn").addEventListener("click", ()=>{
    const q = document.getElementById("searchInput").value.trim();
    if(q) searchCity(q);
  });
  document.getElementById("searchInput").addEventListener("keypress", (e)=>{
    if(e.key==='Enter'){ const q=e.target.value.trim(); if(q) searchCity(q); }
  });

  // =============================
  // Cafe cards rendering
  // =============================
  const cafes = [
    {name:"Arabica Coffee", address:"Al Malaz, Riyadh", lat:24.7136, lng:46.6753, rating:4.5, distance:1.2, open:true, features:["wifi","outdoor"], image:"https://images.unsplash.com/photo-1554118811-1e0d58224f24"},
    {name:"Starbucks Riyadh", address:"Sulimaniyah, Riyadh", lat:24.7612, lng:46.6753, rating:4.7, distance:0.8, open:true, features:["wifi","parking"], image:"https://images.unsplash.com/photo-1509042239860-f550ce710b93"},
    {name:"Deem Coffee", address:"Al Olaya, Riyadh", lat:24.6932, lng:46.6915, rating:4.3, distance:2.3, open:true, features:["outdoor","snacks"], image:"https://images.unsplash.com/photo-1463797221720-6b07e6426c24"}
  ];

  function renderCafeList(){
    const list = document.getElementById("cafeList");
    list.innerHTML = "";
    const filters = {
      wifi: document.getElementById("wifi").checked,
      outdoor: document.getElementById("outdoor").checked,
      parking: document.getElementById("parking").checked,
      openNow: document.getElementById("openNow").checked
    };
    const sortBy = document.getElementById("sortSelect").value;

    let data = cafes.slice();
    if(filters.wifi) data = data.filter(c=>c.features.includes("wifi"));
    if(filters.outdoor) data = data.filter(c=>c.features.includes("outdoor"));
    if(filters.parking) data = data.filter(c=>c.features.includes("parking"));
    if(filters.openNow) data = data.filter(c=>c.open);

    if(sortBy==="distance") data.sort((a,b)=>a.distance-b.distance);
    if(sortBy==="rating") data.sort((a,b)=>b.rating-a.rating);
    if(sortBy==="name") data.sort((a,b)=>a.name.localeCompare(b.name));

    data.forEach((c, i)=>{
      const el = document.createElement("div"); el.className="cafe-card";
      el.innerHTML = `
        <div class="cafe-cover"><img src="${c.image}" alt="${c.name}"></div>
        <div class="cafe-body">
          <div class="cafe-title">${c.name} <span style="color:var(--warning); font-weight:800;"><i class="fa fa-star"></i> ${c.rating}</span></div>
          <div class="cafe-meta">
            <span><i class="fas fa-map-marker-alt"></i> ${c.address}</span>
            <span><i class="fas fa-road"></i> ${c.distance} km</span>
            <span><i class="fas fa-clock"></i> ${c.open ? (lang==='ar'?'ŸÖŸÅÿ™Ÿàÿ≠':'Open') : (lang==='ar'?'ŸÖÿ∫ŸÑŸÇ':'Closed')}</span>
          </div>
          <div class="cafe-meta">
            ${c.features.includes("wifi") ? `<span class="tag wifi"><i class="fa fa-wifi"></i> ${i18n[lang].wifi}</span>` : ""}
            ${c.features.includes("outdoor") ? `<span class="tag outdoor"><i class="fa fa-umbrella-beach"></i> ${i18n[lang].outdoor}</span>` : ""}
            ${c.features.includes("parking") ? `<span class="tag parking"><i class="fa fa-car"></i> ${i18n[lang].parking}</span>` : ""}
            ${c.features.includes("snacks") ? `<span class="tag snacks"><i class="fa fa-cookie-bite"></i> Snacks</span>` : ""}
          </div>
          <div class="actions">
            <button class="btn-a primary" onclick="window.open('https://www.google.com/maps?q=${c.lat},${c.lng}','_blank')"><i class="fas fa-route"></i> ${lang==='ar'?'ÿßŸÑÿ∑ÿ±ŸäŸÇ':'Directions'}</button>
            <button class="btn-a secondary" onclick="alert('Details: ${c.name}')"><i class="fas fa-info-circle"></i> ${lang==='ar'?'ÿ™ŸÅÿßÿµŸäŸÑ':'Details'}</button>
            <button class="btn-a heart" onclick="fav('${c.name}')"><i class="fas fa-heart"></i> ${lang==='ar'?'ŸÖŸÅÿ∂ŸÑ':'Favorite'}</button>
          </div>
        </div>`;
      list.appendChild(el);
      setTimeout(()=>el.classList.add('show'), 100 * i);
    });

    document.getElementById("resultsNumber").textContent = data.length;
  }
  renderCafeList();

  function fav(name){ showToast((lang==='ar'?'ÿ™ŸÖÿ™ ÿ•ÿ∂ÿßŸÅÿ© ':'Added ') + name + (lang==='ar'?' ÿ•ŸÑŸâ ÿßŸÑŸÖŸÅÿ∂ŸÑÿ©':' to favorites'),'t-success'); }

  document.getElementById("wifi").addEventListener("change",renderCafeList);
  document.getElementById("outdoor").addEventListener("change",renderCafeList);
  document.getElementById("parking").addEventListener("change",renderCafeList);
  document.getElementById("openNow").addEventListener("change",renderCafeList);
  document.getElementById("sortSelect").addEventListener("change",renderCafeList);

  // =============================
  // Weather (Open-Meteo, free, city default Riyadh)
  // =============================
  async function getWeather(lat=24.7136, lon=46.6753){
    try{
      const r = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
      const j = await r.json();
      showToast(`Weather: ${j.current_weather.temperature}¬∞C ¬∑ Wind ${j.current_weather.windspeed}km/h`,'t-info');
    }catch(e){ /* ignore */ }
  }
  getWeather();

  // =============================
  // Contact modal open/close
  // =============================
  document.getElementById("openContact").addEventListener("click", ()=>{ document.getElementById("contactModal").style.display='flex'; });
  document.getElementById("closeContact").addEventListener("click", ()=>{ document.getElementById("contactModal").style.display='none'; });
  document.getElementById("adForm").addEventListener("submit", (e)=>{
    e.preventDefault();
    document.getElementById("contactModal").style.display='none';
    showToast('Thanks! We will contact you soon.','t-success');
  
/* ============================
   üîé Search & Cafes (ÿ™ÿ≥ÿ™ÿÆÿØŸÖ ÿØŸàÿßŸÑŸëŸÉ ŸÖÿπ ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿ∑ŸÅŸäŸÅÿ©)
============================ */
// ÿßÿ®ÿ≠ÿ´ ÿ®ÿßŸÑŸÖÿØŸäŸÜÿ© (Nominatim) ‚Äî ÿ™ÿ®ŸÇŸâ ÿØÿßŸÑÿ™ŸÉ ŸÉŸÖÿß ŸáŸäÿå ŸÅŸÇÿ∑ ÿ£ÿ∂ŸÅÿ™ accept-language
async function searchCity(query) {
  try {
    const url = `https://nominatim.openstreetmap.org/search?format=json&accept-language=ar&q=${encodeURIComponent(query + ', Saudi Arabia')}`;
    const res = await fetch(url);
    const results = await res.json();
    if (results.length > 0) {
      const { lat, lon, display_name } = results[0];
      map.setView([lat, lon], 13);
      fetchCafes(lat, lon, document.getElementById('radius')?.value || 3000);
      showNotification && showNotification('‚úÖ ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ: ' + display_name, 'success');
    } else {
      showNotification && showNotification('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿßŸÑŸÖÿØŸäŸÜÿ©', 'error');
    }
  } catch (e) {
    showNotification && showNotification('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ®ÿ≠ÿ´', 'error');
  }
}

// ÿ¨ŸÑÿ® ŸÖŸÇÿßŸáŸä ŸÖŸÜ Overpass (ŸÉŸÖÿß ŸÑÿØŸäŸÉ)
async function fetchCafes(lat, lon, radius = 3000) {
  try {
    const url = `https://overpass-api.de/api/interpreter?data=[out:json];node["amenity"="cafe"](around:${radius},${lat},${lon});out;`;
    const res = await fetch(url);
    const data = await res.json();
    renderCafeList(data.elements || []);
  } catch (e) {
    showNotification && showNotification('ÿ™ÿπÿ∞Ÿëÿ± ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÇÿßŸáŸä', 'error');
  }
}

/* ============================
   üßæ Render Cafes (ÿßÿ≥ÿ™ÿ®ÿØŸÑ ÿØÿßŸÑÿ™ŸÉ ÿ®Ÿáÿ∞Ÿá)
============================ */
function renderCafeList(cafes) {
  // ŸÇÿßÿ¶ŸÖÿ© HTML
  const list = document.getElementById('cafeList');
  if (list) list.innerHTML = '';

  // ÿßŸÖÿ≥ÿ≠ ÿßŸÑÿπŸÑÿßŸÖÿßÿ™ ÿßŸÑŸÇÿØŸäŸÖÿ© ŸÖŸÜ ÿßŸÑÿ∑ÿ®ŸÇÿ©
  cafesLayer && cafesLayer.clearLayers();

  // ÿπÿØŸëÿßÿØ ÿ•ŸÜ Ÿàÿ¨ÿØ
  const counter = document.getElementById('resultsNumber');
  if (counter) counter.textContent = cafes.length;

  cafes.forEach((cafe, i) => {
    const name = (cafe.tags && cafe.tags.name) || 'Unnamed Cafe';
    const addr = (cafe.tags && cafe.tags['addr:street']) || 'No Address';

    // ÿ®ÿ∑ÿßŸÇÿ©
    if (list) {
      const div = document.createElement('div');
      div.className = 'cafe-card';
      div.style.opacity = 0;
      div.innerHTML = `
        <h5>‚òï ${name}</h5>
        <p><i class="fas fa-map-marker-alt"></i> ${addr}</p>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <button class="btn btn-sm btn-outline-light" onclick="openInMaps(${cafe.lat},${cafe.lon})">
            <i class="fas fa-route"></i> Directions
          </button>
          <button class="btn btn-sm btn-outline-danger" onclick="addFavorite && addFavorite('${name.replace(/'/g,"\\'")}')">
            <i class="fas fa-heart"></i> Favorite
          </button>
        </div>
      `;
      list.appendChild(div);
      setTimeout(() => { div.style.opacity = 1; }, i * 80);
    }

    // ŸÖÿßÿ±ŸÉÿ± ÿπŸÑŸâ ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ© ÿ®ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑŸÉŸàÿ®
    if (cafesLayer) {
      const m = L.marker([cafe.lat, cafe.lon], { icon: coffeeIcon });
      m.bindPopup(`<b>${name}</b><br>${addr}`);
      cafesLayer.addLayer(m);
    }
  });

  // ÿ∂ŸÖŸÜŸäŸãÿß: ÿ•ŸÜ ŸÑŸÖ ŸäŸÉŸÜ ŸáŸÜÿßŸÉ ŸÖŸÇÿßŸáŸä
  if (cafes.length === 0) {
    showNotification && showNotification('ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÜÿ™ÿßÿ¶ÿ¨ ŸÅŸä Ÿáÿ∞Ÿá ÿßŸÑŸÖŸÜÿ∑ŸÇÿ©', 'info');
  }
}

// ŸÅÿ™ÿ≠ ÿßŸÑÿßÿ™ÿ¨ÿßŸáÿßÿ™ ŸÅŸä Google Maps
function openInMaps(lat, lon) {
  window.open(`https://www.google.com/maps/dir/?api=1&destination=${lat},${lon}`, '_blank');
}

// ÿßÿ®ÿØÿ£ ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ© ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÄ DOM
document.addEventListener('DOMContentLoaded', initMap);
</script>

    /* =============================
       üåå ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿßÿ™ + ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™
    ============================== */
    :root {
      --primary: #734f35;
      --secondary: #8b4513;
      --accent: #c4a484;
      --light: #f5f5f5;
      --dark: #0a1929;
      --success: #00ff8c;
      --warning: #ffd166;
      --danger: #ff6b6b;
      --gray: #6c757d;
      --coffee-light: #d7ccc8;
      --coffee-dark: #5d4037;
      --space-blue: #0a1929;
      --space-purple: #7158e2;
      --neon-blue: #18dcff;
      --neon-pink: #ff4d8d;
      --neon-green: #00ff8c;
      --cyber-yellow: #ffd166;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #0a0e17;
      color: #e9ecef;
      line-height: 1.6;
      overflow-x: hidden;
      transition: all 0.3s ease;
      background-image:
        radial-gradient(circle at 15% 50%, rgba(24,220,255,0.05) 0%, transparent 25%),
        radial-gradient(circle at 85% 30%, rgba(113,88,226,0.05) 0%, transparent 25%),
        radial-gradient(circle at 50% 80%, rgba(255,77,141,0.05) 0%, transparent 25%);
    } 
    <!-- ====== MAP SECTION (Top of page) ====== -->
<section style="max-width:1200px;margin:20px auto;">
  <div id="map" style="height:520px;border-radius:12px;overflow:hidden;"></div>
  <div style="display:flex;gap:10px;align-items:center;margin-top:12px;">
    <input id="searchInput" type="text" placeholder="ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖÿØŸäŸÜÿ© ÿØÿßÿÆŸÑ ÿßŸÑÿ≥ÿπŸàÿØŸäÿ©..." 
           style="flex:1;padding:12px 14px;border-radius:10px;border:1px solid #2a3e5a;background:#0f1525;color:#e9ecef;">
    <select id="radius" style="padding:10px 12px;border-radius:10px;border:1px solid #2a3e5a;background:#0f1525;color:#e9ecef;">
      <option value="1000">1 ŸÉŸÖ</option>
      <option value="3000" selected>3 ŸÉŸÖ</option>
      <option value="5000">5 ŸÉŸÖ</option>
      <option value="10000">10 ŸÉŸÖ</option>
    </select>
    <button id="searchBtn" class="btn btn-primary" style="padding:12px 18px;border:none;border-radius:10px;background:linear-gradient(135deg,#18dcff,#7158e2);">
      <i class="fas fa-search"></i> ÿ®ÿ≠ÿ´
    </button>
    <!-- ÿ≤ÿ± ¬´ÿ®ÿßŸÑŸÇÿ±ÿ® ŸÖŸÜŸä¬ª ŸÖŸàÿ¨ŸàÿØ ŸÉŸÉŸÜÿ™ÿ±ŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ© ÿ£Ÿäÿ∂Ÿãÿßÿå ŸÑŸÉŸÜ ŸàŸÅÿ±ÿ™Ÿá ŸáŸÜÿß ŸÑŸÖŸÜ ŸäŸÅÿ∂ŸëŸÑ ÿ≤ÿ±Ÿãÿß ÿÆÿßÿ±ÿ¨ŸäŸãÿß -->
    <button id="nearbyBtn" style="padding:12px 18px;border:none;border-radius:10px;background:#18dcff;color:#000;font-weight:700;">
      üìç ÿ®ÿßŸÑŸÇÿ±ÿ® ŸÖŸÜŸä
    </button>
  </div>
</section>

// ÿßŸÑÿ®ÿ≠ÿ´ ÿ®ÿßŸÑŸÖÿØŸäŸÜÿ© (Nominatim)
async function searchCity(query) {
  const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query + ", Saudi Arabia")}`;
  const res = await fetch(url); const results = await res.json();
  if(results.length>0) {
    const {lat,lon} = results[0];
    map.setView([lat,lon],13);
    fetchCafes(lat, lon, document.getElementById("radius").value);
    showNotification("‚úÖ Found city: "+results[0].display_name);
  } else showNotification("‚ùå City not found");
}

// ÿ¨ŸÑÿ® ÿßŸÑŸÖŸÇÿßŸáŸä ŸÖŸÜ OSM (Overpass)
async function fetchCafes(lat, lon, radius) {
  const url = `https://overpass-api.de/api/interpreter?data=[out:json];node["amenity"="cafe"](around:${radius},${lat},${lon});out;`;
  const res = await fetch(url); const data = await res.json();
  renderCafeList(data.elements);
}

// ÿπÿ±ÿ∂ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
function renderCafeList(cafes) {
  const list = document.getElementById("cafeList");
  list.innerHTML = "";
  cafes.forEach((cafe,i)=>{
    const name = cafe.tags.name || "Unnamed Cafe";
    const addr = cafe.tags["addr:street"] || "No Address";
    const div = document.createElement("div");
    div.className="cafe-card"; div.style.opacity=0;
    div.innerHTML = `
      <h5>‚òï ${name}</h5>
      <p><i class="fas fa-map-marker-alt"></i> ${addr}</p>
      <button class="btn btn-sm btn-outline-light" onclick="openInMaps(${cafe.lat},${cafe.lon})"><i class="fas fa-route"></i> Directions</button>
      <button class="btn btn-sm btn-outline-danger" onclick="addFavorite('${name}')"><i class="fas fa-heart"></i> Favorite</button>
    `;
    list.appendChild(div);
    setTimeout(()=>{div.style.opacity=1;}, i*100);
    // Marker
    const marker = L.marker([cafe.lat,cafe.lon]).addTo(map);
    marker.bindPopup(`<b>${name}</b><br>${addr}`);
  });
}

// ŸÅÿ™ÿ≠ ÿßŸÑŸÖŸàŸÇÿπ ŸÅŸä Google Maps
function openInMaps(lat,lon){
  window.open(`https://www.google.com/maps/dir/?api=1&destination=${lat},${lon}`,"_blank");
}
    /* ÿÆŸÑŸÅŸäÿ© ŸÅÿ∂ÿßÿ¶Ÿäÿ© */
    body.space-theme {
      background-image: url("https://www.transparenttextures.com/patterns/stardust.png"),
        radial-gradient(circle at 15% 50%, rgba(24,220,255,0.1) 0%, transparent 25%),
        radial-gradient(circle at 85% 30%, rgba(113,88,226,0.1) 0%, transparent 25%),
        radial-gradient(circle at 50% 80%, rgba(255,77,141,0.1) 0%, transparent 25%);
    }
 /* ÿ®ÿÆÿßÿ± ÿßŸÑŸÇŸáŸàÿ© */
    .coffee-steam { position: relative; display: inline-block; }
    .steam {
      position: absolute; width: 15px; height: 15px;
      border-radius: 50%; background: rgba(255,255,255,0.6);
      animation: rise 4s ease-in-out infinite;
      opacity: 0;
    } 
     .steam.one { left: -10px; animation-delay: 0s; }
    .steam.two { left: 0px; animation-delay: 1s; }
    .steam.three { left: 10px; animation-delay: 2s; }
    @keyframes rise {
      0% { transform: translateY(0) scale(0.4); opacity: 0.7; }
      100% { transform: translateY(-60px) scale(1.2); opacity: 0; }
    }

    #map { height: 500px; border-radius: 12px; margin: 20px 0; }

    .cafe-card {
      background: #131c2f;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      transition: transform 0.3s;
    }
    .cafe-card:hover { transform: translateY(-5px); border:1px solid var(--neon-blue); }
    .cafe-card h5 { margin-bottom: 8px; }
    /* =============================
       üõ∞Ô∏è ÿßŸÑÿ´ŸäŸÖÿßÿ™
    ============================== */
    [data-theme="light"] {
      --bg-primary: #f8f9fa;
      --bg-secondary: #ffffff;
      --text-primary: #212529;
      --text-secondary: #495057;
      --card-bg: #ffffff;
      --border-color: #dee2e6;
      --header-bg: linear-gradient(135deg, var(--primary), var(--secondary));
    }

    [data-theme="dark"] {
      --bg-primary: #0a1929;
      --bg-secondary: #0f253d;
      --text-primary: #e9ecef;
      --text-secondary: #adb5bd;
      --card-bg: #132238;
      --border-color: #2a3e5a;
      --header-bg: linear-gradient(135deg, #132238, #1e3a5f);
    }

    [data-theme="space"] {
      --bg-primary: #0a0e17;
      --bg-secondary: #0f1525;
      --text-primary: #e9ecef;
      --text-secondary: #8b9bb4;
      --card-bg: #131c2f;
      --border-color: #24334d;
      --header-bg: linear-gradient(135deg, #131c2f, #1e2f4f);
    }

    [data-theme="neon"] {
      --bg-primary: #0a0a0a;
      --bg-secondary: #111;
      --text-primary: #18dcff;
      --text-secondary: #ff4d8d;
      --card-bg: #1a1a1a;
      --border-color: #333;
      --header-bg: linear-gradient(135deg, #18dcff, #7158e2);
    }

    [data-theme="energy"] {
      --bg-primary: #fffdf5;
      --bg-secondary: #fdf2d5;
      --text-primary: #222;
      --text-secondary: #555;
      --card-bg: #fff9e6;
      --border-color: #f0d9b5;
      --header-bg: linear-gradient(135deg, #ffd166, #ff4d8d);
    }

    [data-theme="sleep"] {
      --bg-primary: #001f3f;
      --bg-secondary: #012a4a;
      --text-primary: #cce7ff;
      --text-secondary: #8aaacb;
      --card-bg: #013a63;
      --border-color: #01497c;
      --header-bg: linear-gradient(135deg, #001f3f, #013a63);
    }

    /* =============================
       üåü ÿßŸÑŸáŸäÿØÿ± + ÿ®ÿÆÿßÿ± ÿßŸÑŸÉŸàÿ®
    ============================== */
    header {
      background: var(--header-bg);
      padding: 20px;
      border-radius: 16px;
      margin: 20px auto;
      max-width: 1400px;
      color: white;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
      position: relative;
      overflow: hidden;
    }

    .brand {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      font-size: 2.2rem;
      font-weight: 800;
    }

    .brand i {
      color: var(--neon-blue);
      filter: drop-shadow(0 0 5px var(--neon-blue));
    }

    .coffee-steam {
      display: inline-block;
      margin-left: 10px;
      position: relative;
    }

    .steam {
      position: absolute;
      height: 20px;
      width: 20px;
      border-radius: 50%;
      background: linear-gradient(to bottom, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.1));
      margin-top: -25px;
      margin-left: 5px;
      opacity: 0;
    }

    .steam.one { animation: steam-one 4s ease-out infinite; }
    .steam.two { animation: steam-two 4s ease-out 1s infinite; }
    .steam.three { animation: steam-three 4s ease-out 2s infinite; }

    @keyframes steam-one {
      0% { transform: translateY(0) scale(0.3); opacity: 0.6; }
      100% { transform: translateY(-50px) translateX(-10px) scale(1.5); opacity: 0; }
    }

    @keyframes steam-two {
      0% { transform: translateY(0) scale(0.3); opacity: 0.6; }
      100% { transform: translateY(-45px) translateX(10px) scale(1.5); opacity: 0; }
    }

    @keyframes steam-three {
      0% { transform: translateY(0) scale(0.3); opacity: 0.6; }
      100% { transform: translateY(-40px) translateX(-5px) scale(1.5); opacity: 0; }
    }

    /* =============================
       üîç ÿßŸÑÿ®ÿ≠ÿ´ + ÿßŸÑŸÅŸÑÿßÿ™ÿ±
    ============================== */
    .search-panel {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 20px;
      margin: 20px auto;
      max-width: 1200px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .search-input {
      display: flex;
      gap: 10px;
    }

    .search-input input {
      flex: 1;
      padding: 12px 18px;
      border-radius: 10px;
      border: 1px solid var(--border-color);
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 1rem;
    }

    .btn-search {
      background: linear-gradient(135deg, var(--neon-blue), var(--space-purple));
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
    }

    .filters {
      margin-top: 15px;
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
    }

    .filter-item {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      padding: 8px 15px;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.9rem;
    }

    /* =============================
       üó∫Ô∏è ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ©
    ============================== */
  
<!-- Map -->
  <section class="map-wrap">
    <div id="map"></div>
  </section>

  <!-- Results -->
  <section class="results-section">
    <div class="results-header d-flex justify-content-between align-items-center">
      <h2 class="m-0" style="font-size:1.15rem;">
        <span data-i18n="found">Found</span> <span id="resultsNumber">0</span> <span data-i18n="shops">coffee shops</span>
      </h2>
      <select id="sortSelect" class="form-select form-select-sm" style="max-width:200px;">
        <option value="distance" data-i18n="closest">Closest First</option>
        <option value="rating" data-i18n="highest">Highest Rated</option>
        <option value="name" data-i18n="byname">By Name</option>
      </select>
    </div>
    <div id="cafeList" class="cafe-grid"></div>
  </section>
    #map { width: 100%; height: 100%; }

  </style>
</head>
<body data-theme="space" class="space-theme">
  <!-- üó∫Ô∏è ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ© -->
  <section class="map-container">
    <div id="map"></div>
  </section>

  <!-- üåå ÿßŸÑŸáŸäÿØÿ± -->
  <header>
    <div class="brand">
      <i class="fas fa-mug-hot"></i>
      Coffee Finder Pro
      <div class="coffee-steam">
        <div class="steam one"></div>
        <div class="steam two"></div>
        <div class="steam three"></div>
      </div>
    </div>
  </header>

  <!-- üîç ŸÑŸàÿ≠ÿ© ÿßŸÑÿ®ÿ≠ÿ´ -->
  <section class="search-panel">
    <div class="search-input">
      <input type="text" id="searchInput" placeholder="Search for a city in Saudi Arabia..." />
      <button class="btn-search" id="searchBtn"><i class="fas fa-search"></i> Search</button>
    </div>
    <div class="filters">
      <div class="filter-item"><input type="checkbox" id="wifi"><label for="wifi">Wi-Fi</label></div>
      <div class="filter-item"><input type="checkbox" id="outdoor"><label for="outdoor">Outdoor</label></div>
      <div class="filter-item"><input type="checkbox" id="parking"><label for="parking">Parking</label></div>
      <div class="filter-item"><input type="checkbox" id="openNow"><label for="openNow">Open Now</label></div>
      <div class="filter-item">
        <label for="radius">Radius:</label>
        <select id="radius">
          <option value="1000">1 km</option>
          <option value="3000" selected>3 km</option>
          <option value="5000">5 km</option>
          <option value="10000">10 km</option>
        </select>
      </div>
    </div>
  </section>

  <!-- üó∫Ô∏è ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ© -->
  <section class="map-container">
    <div id="map"></div>
  </section>
  <!-- ‚òï ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÖŸÇÿßŸáŸä -->
  <section class="results-section container">
    <div class="results-header d-flex justify-content-between align-items-center mb-4 p-3"
         style="background: var(--card-bg); border-radius:12px; border:1px solid var(--border-color);">
      <h2 class="results-count">Found <span id="resultsNumber">0</span> coffee shops</h2>
      <select class="sort-select" id="sortSelect">
        <option value="distance">Closest First</option>
        <option value="rating">Highest Rated</option>
        <option value="name">By Name</option>
      </select>
    </div>

    <div class="cafe-list" id="cafeList"
         style="display:grid; grid-template-columns:repeat(auto-fill, minmax(320px,1fr)); gap:25px; margin-bottom:40px;">
      <!-- ÿßŸÑŸÉÿ±Ÿàÿ™ ÿ≥ÿ™ÿ∏Ÿáÿ± ŸáŸÜÿß ÿØŸäŸÜÿßŸÖŸäŸÉŸäÿßŸã -->
    </div>
  </section>

  <style>
    /* =============================
       üé¥ ŸÉÿ±Ÿàÿ™ ÿßŸÑŸÖŸÇÿßŸáŸä
    ============================== */
    .cafe-card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      overflow: hidden;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      opacity: 0;
      transform: translateY(30px);
    }
    .cafe-card.show {
      opacity: 1;
      transform: translateY(0);
      transition: all 0.6s ease;
    }
    .cafe-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.5);
      border-color: var(--neon-blue);
    }

    .cafe-image {
      height: 200px;
      background: linear-gradient(135deg, var(--coffee-light), var(--coffee-dark));
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    .cafe-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.5s ease;
    }
    .cafe-card:hover .cafe-image img {
      transform: scale(1.1);
    }

    .cafe-info {
      padding: 20px;
    }
    .cafe-name {
      font-weight: 800;
      font-size: 1.3rem;
      margin-bottom: 10px;
      color: var(--text-primary);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .cafe-meta {
      display: flex;
      gap: 15px;
      font-size: 0.95rem;
      color: var(--text-secondary);
      margin-bottom: 12px;
    }
    .rating { color: var(--warning); font-weight: bold; }

    .cafe-features {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 15px;
    }
    .feature-tag {
      font-size: 0.85rem;
      padding: 5px 12px;
      border-radius: 15px;
      border: 1px solid rgba(255,255,255,0.2);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .feature-tag.wifi {
      background: rgba(24,220,255,0.15);
      color: var(--neon-blue);
    }
    .feature-tag.outdoor {
      background: rgba(255,209,102,0.15);
      color: var(--warning);
    }
    .feature-tag.parking {
      background: rgba(0,255,140,0.15);
      color: var(--success);
    }
    .feature-tag.snacks {
      background: rgba(255,77,141,0.15);
      color: var(--neon-pink);
    }

    .cafe-actions {
      display: flex;
      gap: 10px;
    }
    .action-btn {
      flex: 1;
      padding: 10px 16px;
      border-radius: 10px;
      font-weight: 700;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: all 0.3s;
    }
    .action-btn.directions {
      background: linear-gradient(135deg, var(--neon-blue), var(--space-purple));
      color: white;
    }
    .action-btn.details {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
    }
    .action-btn.favorite {
      background: rgba(255,77,141,0.15);
      color: var(--neon-pink);
      border: 1px solid rgba(255,77,141,0.4);
    }
    .action-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
  </style>

  <script>
    // =============================
    // üé≤ ÿ®ŸäÿßŸÜÿßÿ™ ÿ™ÿ¨ÿ±Ÿäÿ®Ÿäÿ© ŸÑŸÑŸÖŸÇÿßŸáŸä
    // =============================
    const cafeData = [
      {
        name: "Arabica Coffee",
        address: "Al Malaz, Riyadh",
        lat: 24.7136, lng: 46.6753,
        rating: 4.5,
        distance: 1.2,
        open: true,
        features: ["wifi", "outdoor"],
        image: "https://images.unsplash.com/photo-1554118811-1e0d58224f24"
      },
      {
        name: "Starbucks Riyadh",
        address: "Sulimaniyah, Riyadh",
        lat: 24.7612, lng: 46.6753,
        rating: 4.7,
        distance: 0.8,
        open: true,
        features: ["wifi", "parking"],
        image: "https://images.unsplash.com/photo-1509042239860-f550ce710b93"
      },
      {
        name: "Deem Coffee",
        address: "Al Olaya, Riyadh",
        lat: 24.6932, lng: 46.6915,
        rating: 4.3,
        distance: 2.3,
        open: true,
        features: ["outdoor", "snacks"],
        image: "https://images.unsplash.com/photo-1463797221720-6b07e6426c24"
      }
    ];

    // =============================
    // üñºÔ∏è ÿπÿ±ÿ∂ ÿ®ÿ∑ÿßŸÇÿßÿ™ ÿßŸÑŸÖŸÇÿßŸáŸä
    // =============================
    function renderCafeList() {
      const cafeList = document.getElementById("cafeList");
      cafeList.innerHTML = "";
      document.getElementById("resultsNumber").textContent = cafeData.length;

      cafeData.forEach((cafe, index) => {
        const card = document.createElement("div");
        card.className = "cafe-card";
        card.innerHTML = `
          <div class="cafe-image">
            <img src="${cafe.image}" alt="${cafe.name}">
          </div>
          <div class="cafe-info">
            <h3 class="cafe-name">${cafe.name}
              <span class="rating"><i class="fas fa-star"></i> ${cafe.rating}</span>
            </h3>
            <div class="cafe-meta">
              <span><i class="fas fa-map-marker-alt"></i> ${cafe.address}</span>
              <span><i class="fas fa-road"></i> ${cafe.distance} km</span>
              <span><i class="fas fa-clock"></i> ${cafe.open ? "Open" : "Closed"}</span>
            </div>
            <div class="cafe-features">
              ${cafe.features.includes("wifi") ? `<span class="feature-tag wifi"><i class="fas fa-wifi"></i> Wi-Fi</span>` : ""}
              ${cafe.features.includes("outdoor") ? `<span class="feature-tag outdoor"><i class="fas fa-umbrella-beach"></i> Outdoor</span>` : ""}
              ${cafe.features.includes("parking") ? `<span class="feature-tag parking"><i class="fas fa-car"></i> Parking</span>` : ""}
              ${cafe.features.includes("snacks") ? `<span class="feature-tag snacks"><i class="fas fa-utensils"></i> Snacks</span>` : ""}
            </div>
            <div class="cafe-actions">
              <button class="action-btn directions"><i class="fas fa-route"></i> Directions</button>
              <button class="action-btn details"><i class="fas fa-info-circle"></i> Details</button>
              <button class="action-btn favorite"><i class="fas fa-heart"></i> Favorite</button>
            </div>
          </div>
        `;
        cafeList.appendChild(card);

        // ÿßŸÜŸäŸÖŸäÿ¥ŸÜ ÿßŸÑÿ∏ŸáŸàÿ±
        setTimeout(() => card.classList.add("show"), index * 150);
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      renderCafeList();
    });
  </script>
  <!-- ü§ñ Chatbot -->
  <div class="chatbot-container" style="position:fixed; bottom:30px; left:30px; z-index:1000;">
    <button class="chatbot-toggle" id="chatbotToggle"
            style="width:60px; height:60px; border-radius:50%; background:linear-gradient(135deg,var(--neon-pink),var(--space-purple));
                   color:white; border:none; font-size:24px; box-shadow:0 4px 20px rgba(255,77,141,0.4);">
      <i class="fas fa-robot"></i>
    </button>
    <div class="chatbot-window" id="chatbotWindow"
         style="display:none; flex-direction:column; position:absolute; bottom:70px; left:0; width:350px; height:450px;
                background:var(--card-bg); border:1px solid var(--border-color); border-radius:16px; box-shadow:0 4px 20px rgba(0,0,0,0.5);">
      <div class="chatbot-header d-flex justify-content-between align-items-center p-2"
           style="background:var(--bg-secondary); border-bottom:1px solid var(--border-color);">
        <h5 class="m-0">Coffee Assistant</h5>
        <button class="btn-close" id="closeChatbot"></button>
      </div>
      <div class="chatbot-messages flex-grow-1 p-3" id="chatbotMessages"
           style="overflow-y:auto; display:flex; flex-direction:column; gap:10px;"></div>
      <div class="chatbot-input d-flex p-2" style="border-top:1px solid var(--border-color); gap:8px;">
        <input type="text" id="chatbotInput" placeholder="Type here..."
               style="flex:1; border-radius:20px; border:1px solid var(--border-color); padding:8px 12px;">
        <button id="sendMessage"
                style="width:45px; height:45px; border-radius:50%; border:none;
                       background:linear-gradient(135deg,var(--neon-blue),var(--space-purple)); color:white;">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- üîî ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ -->
  <div id="notifications"></div>
  <style>
    #notifications {
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 2000;
    }
    .notification {
      padding: 12px 18px;
      border-radius: 10px;
      font-weight: 600;
      color: white;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      animation: slideIn 0.4s ease;
    }
    @keyframes slideIn {
      from { transform: translateX(120%); opacity:0; }
      to   { transform: translateX(0); opacity:1; }
    }
    .notification.success { background:linear-gradient(135deg,#00ff8c,#00b36b); }
    .notification.error   { background:linear-gradient(135deg,#ff6b6b,#cc5555); }
    .notification.info    { background:linear-gradient(135deg,#18dcff,#7158e2); }
  </style>

  <script>
    // =============================
    // üîî ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™
    // =============================
    function showNotification(message, type="info") {
      const container = document.getElementById("notifications");
      const n = document.createElement("div");
      n.className = `notification ${type}`;
      n.textContent = message;
      container.appendChild(n);
      setTimeout(()=> { n.style.opacity=0; setTimeout(()=>n.remove(),500); }, 3000);
    }

    // =============================
    // ü§ñ Chatbot
    // =============================
    function addChatMessage(text, sender="bot") {
      const messages = document.getElementById("chatbotMessages");
      const div = document.createElement("div");
      div.className = "message " + sender;
      div.style.cssText = `
        padding:10px 15px;
        border-radius:15px;
        max-width:80%;
        line-height:1.4;
      `;
      if(sender==="bot"){
        div.style.background="var(--bg-secondary)";
        div.style.alignSelf="flex-start";
        div.style.color="var(--text-primary)";
      } else {
        div.style.background="linear-gradient(135deg,var(--neon-blue),var(--space-purple))";
        div.style.color="white";
        div.style.alignSelf="flex-end";
      }
      div.textContent = text;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    }

    const botResponses = [
      "Hello! How can I help you find coffee?",
      "Looking for Wi-Fi or outdoor seating?",
      "I can recommend top rated cafes nearby.",
      "Would you like espresso or latte style places?",
      "Searching... give me a second!"
    ];

    document.getElementById("chatbotToggle").addEventListener("click", ()=>{
      const w = document.getElementById("chatbotWindow");
      w.style.display = w.style.display==="flex" ? "none":"flex";
    });
    document.getElementById("closeChatbot").addEventListener("click", ()=>{
      document.getElementById("chatbotWindow").style.display="none";
    });
    document.getElementById("sendMessage").addEventListener("click", ()=>{
      const input = document.getElementById("chatbotInput");
      const msg = input.value.trim();
      if(!msg) return;
      addChatMessage(msg,"user");
      input.value="";
      setTimeout(()=>{
        const r = botResponses[Math.floor(Math.random()*botResponses.length)];
        addChatMessage(r,"bot");
      },800);
    });

    // =============================
    // üéÆ Gamification + Confetti
    // =============================
    let points = 0;
    function addPoints(p=10) {
      points += p;
      if(points % 50 === 0) {
        showNotification(`Level Up! üåü You now have ${points} points!`,"success");
        launchConfetti();
      } else {
        showNotification(`+${p} points! Total: ${points}`,"info");
      }
    }

    function launchConfetti() {
      const duration = 2 * 1000;
      const end = Date.now() + duration;
      (function frame() {
        const confetti = document.createElement("div");
        confetti.style.position="fixed";
        confetti.style.left=Math.random()*100+"vw";
        confetti.style.top="0px";
        confetti.style.width="10px";
        confetti.style.height="10px";
        confetti.style.borderRadius="50%";
        confetti.style.background=`hsl(${Math.random()*360},100%,50%)`;
        confetti.style.opacity=0.8;
        confetti.style.zIndex=3000;
        document.body.appendChild(confetti);
        const fall = setInterval(()=>{
          const top = parseFloat(confetti.style.top);
          if(top > window.innerHeight) { confetti.remove(); clearInterval(fall);}
          confetti.style.top = top+5+"px";
        },30);
        if(Date.now()<end) requestAnimationFrame(frame);
      })();
    }

    // ÿ±ÿ®ÿ∑ ÿßŸÑŸÖŸÅÿ∂ŸÑÿ© ŸÖÿπ ÿßŸÑŸÜŸÇÿßÿ∑
    document.addEventListener("click",(e)=>{
      if(e.target.closest(".action-btn.favorite")){
        addPoints(20);
        showNotification("Added to favorites ‚ù§Ô∏è","success");
      }
    });
  </script>

  <!-- üåå ŸÖÿ§ÿ´ÿ±ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© -->
  <style>
    .neon-text {
      text-shadow: 0 0 5px var(--neon-blue),
                   0 0 10px var(--neon-pink),
                   0 0 15px var(--neon-blue),
                   0 0 20px var(--space-purple);
    }
    .glitch {
      position: relative;
      color: white;
      font-size: 2rem;
      font-weight: bold;
    }
    .glitch::before,
    .glitch::after {
      content: attr(data-text);
      position: absolute;
      left: 0; top: 0;
      width: 100%; overflow: hidden;
    }
    .glitch::before {
      left: 2px; text-shadow: -2px 0 red; animation: glitch 2s infinite linear alternate-reverse;
    }
    .glitch::after {
      left: -2px; text-shadow: -2px 0 blue; animation: glitch 1.5s infinite linear alternate-reverse;
    }
    @keyframes glitch {
      0% { clip: rect(44px,9999px,56px,0); }
      20% { clip: rect(12px,9999px,80px,0); }
      40% { clip: rect(85px,9999px,140px,0); }
      60% { clip: rect(24px,9999px,70px,0); }
      80% { clip: rect(50px,9999px,90px,0); }
      100% { clip: rect(10px,9999px,130px,0); }
    }
  </style>
 
  <!-- üåê ŸÖÿ®ÿØŸÑ ÿßŸÑŸÑÿ∫ÿ© -->
  <div class="language-switcher" style="position:fixed; top:20px; right:20px; z-index:2000;">
    <button id="langToggle"
            style="padding:8px 14px; border:none; border-radius:20px; background:rgba(255,255,255,0.2);
                   color:white; cursor:pointer; backdrop-filter:blur(10px);">
      ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
    </button>
  </div>

  <script>
       // =============================
    // üó∫Ô∏è ÿßŸÑÿ®ÿ≠ÿ´ (Nominatim + Overpass)
    // =============================
    async function searchCity(query) {
      try {
        const url = `https://nominatim.openstreetmap.org/search?format=json&q=${query}, Saudi Arabia`;
        const res = await fetch(url);
        const data = await res.json();
        if(data && data.length>0){
          const {lat, lon, display_name} = data[0];
          map.setView([lat,lon], 13);
          showNotification(`Found ${display_name}`,"success");
          getWeather(display_name);
          fetchCafes(lat,lon);
        } else {
          showNotification("City not found","error");
        }
      } catch(err){
        showNotification("Search error","error");
      }
    }

    async function fetchCafes(lat,lon){
      const overpassUrl = "https://overpass-api.de/api/interpreter";
      const radius = document.getElementById("radius").value || 3000;
      const query = `
        [out:json];
        (
          node["amenity"="cafe"](around:${radius},${lat},${lon});
        );
        out;
      `;
      try {
        const res = await fetch(overpassUrl, {method:"POST", body:query});
        const data = await res.json();
        cafeData.length = 0; // clear
        data.elements.forEach(el=>{
          cafeData.push({
            name: el.tags.name || "Unnamed Cafe",
            address: el.tags["addr:street"] || "Unknown",
            lat: el.lat,
            lng: el.lon,
            rating: (Math.random()*2+3).toFixed(1),
            distance: Math.floor(Math.random()*5)+1,
            open: Math.random()>0.3,
            features: ["wifi","outdoor","snacks"].filter(()=>Math.random()>0.5),
            image: "https://source.unsplash.com/400x300/?coffee,cafe"
          });
        });
        renderCafeList();
        showNotification(`Loaded ${cafeData.length} cafes`,"success");
      } catch(err){
        showNotification("Failed to load cafes","error");
      }
    }

    // ÿ±ÿ®ÿ∑ ÿ≤ÿ± ÿßŸÑÿ®ÿ≠ÿ´
    document.getElementById("searchBtn").addEventListener("click",()=>{
      const q = document.getElementById("searchInput").value.trim();
      if(q) searchCity(q);
    });
    document.getElementById("searchInput").addEventListener("keypress",(e)=>{
      if(e.key==="Enter"){
        const q = document.getElementById("searchInput").value.trim();
        if(q) searchCity(q);
      }
    });

    // =============================
    // ‚ö° ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ∑ÿßŸÇÿ©
    // =============================
    window.addEventListener("scroll",()=>{
      const h = document.documentElement;
      const st = h.scrollTop;
      const sh = h.scrollHeight - h.clientHeight;
      const p = (st/sh)*100;
      document.querySelector(".energy-bar").style.width = p+"%";
    });

    // =============================
    // üåê ÿ™ÿπÿØÿØ ÿßŸÑŸÑÿ∫ÿßÿ™
    // =============================
    let lang="en";
    document.getElementById("langToggle").addEventListener("click",()=>{
      lang = (lang==="en"?"ar":"en");
      if(lang==="ar"){
        document.body.dir="rtl";
        document.getElementById("langToggle").textContent="English";
        showNotification("ÿ™ŸÖ ÿßŸÑÿ™ÿ®ÿØŸäŸÑ ÿ•ŸÑŸâ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©","info");
      } else {
        document.body.dir="ltr";
        document.getElementById("langToggle").textContent="ÿßŸÑÿπÿ±ÿ®Ÿäÿ©";
        showNotification("Language switched to English","info");
      }
    });

    // =============================
    // üì§ ŸÖÿ¥ÿßÿ±ŸÉÿ© + QR
    // =============================
    function shareCafe(cafe){
      const url = `https://www.google.com/maps?q=${cafe.lat},${cafe.lng}`;
      if(navigator.share){
        navigator.share({title:cafe.name, text:"Check this cafe!", url});
      } else {
        prompt("Copy this link:",url);
      }
    }

    function generateQR(cafe){
      const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(cafe.name+" "+cafe.lat+","+cafe.lng)}`;
      const w = window.open("","_blank","width=200,height=200");
      w.document.write(`<img src="${qrUrl}" alt="QR Code">`);
    }

    // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ÿ∑ÿßŸÇÿßÿ™ ŸÑÿßÿ∂ÿßŸÅÿ© ÿ≤ÿ± ŸÖÿ¥ÿßÿ±ŸÉÿ© Ÿà QR
    function renderCafeList(){
      const cafeList = document.getElementById("cafeList");
      cafeList.innerHTML="";
      document.getElementById("resultsNumber").textContent=cafeData.length;
      cafeData.forEach((cafe,index)=>{
        const card = document.createElement("div");
        card.className="cafe-card";
        card.innerHTML=`
          <div class="cafe-image"><img src="${cafe.image}" alt="${cafe.name}"></div>
          <div class="cafe-info">
            <h3 class="cafe-name">${cafe.name}<span class="rating"><i class="fas fa-star"></i> ${cafe.rating}</span></h3>
            <div class="cafe-meta">
              <span><i class="fas fa-map-marker-alt"></i> ${cafe.address}</span>
              <span><i class="fas fa-road"></i> ${cafe.distance} km</span>
              <span><i class="fas fa-clock"></i> ${cafe.open?"Open":"Closed"}</span>
            </div>
            <div class="cafe-features">
              ${cafe.features.map(f=>`<span class="feature-tag ${f}">${f}</span>`).join("")}
            </div>
            <div class="cafe-actions">
              <button class="action-btn directions" onclick="window.open('https://www.google.com/maps?q=${cafe.lat},${cafe.lng}','_blank')"><i class="fas fa-route"></i> Directions</button>
              <button class="action-btn details" onclick="alert('Details about ${cafe.name}')"><i class="fas fa-info-circle"></i> Details</button>
              <button class="action-btn favorite"><i class="fas fa-heart"></i> Favorite</button>
              <button class="action-btn" onclick='shareCafe(${JSON.stringify(cafe)})'><i class="fas fa-share"></i> Share</button>
              <button class="action-btn" onclick='generateQR(${JSON.stringify(cafe)})'><i class="fas fa-qrcode"></i> QR</button>
            </div>
          </div>
        `;
        cafeList.appendChild(card);
        setTimeout(()=>card.classList.add("show"),index*100);
      });
    }

    // =============================
    // üìÇ Offline Mode
    // =============================
    window.addEventListener("offline",()=>{
      showNotification("‚ö†Ô∏è You are offline!","error");
    });
    window.addEventListener("online",()=>{
      showNotification("‚úÖ Back online!","success");
    });

    // =============================
    // üéÆ Easter Egg
    // =============================
    document.addEventListener("keydown",(e)=>{
      if(e.ctrlKey && e.shiftKey && e.code==="KeyC"){
        const egg=document.createElement("div");
        egg.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:black;color:lime;font-size:2rem;display:flex;align-items:center;justify-content:center;z-index:5000;";
        egg.textContent="‚òï The Coffee Matrix has you... ‚òï";
        document.body.appendChild(egg);
        setTimeout(()=>egg.remove(),4000);
      }
    });
  </script>

  <!-- =============================
       üë£ Footer
  ============================== -->
  <footer class="text-center p-4 mt-5" style="color:var(--text-secondary); border-top:1px solid var(--border-color);">
    <p>¬© 2025 Coffee Finder Pro ‚Äî Sci-Fi Edition</p>
    <p>Discover the best coffee shops across Saudi Arabia</p>
  </footer>

  <!-- ŸÖŸÉÿ™ÿ®ÿßÿ™ JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</body>
</html>

<!-- ====================== PART 7 START ====================== -->
             <!-- ================= EXTRA FEATURES PART 4 ================= -->
        <!-- Reading Mode -->
        <button id="readingModeBtn" class="reading-mode-btn">
            <i class="fas fa-book-reader"></i>
        </button>

        <style>
            .reading-mode-btn {
                position: fixed;
                bottom: 160px;
                right: 30px;
                width: 55px;
                height: 55px;
                border-radius: 50%;
                background: linear-gradient(135deg, #00ff8c, #00b36b);
                color: white;
                border: none;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                z-index: 1400;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            }
            body.reading-mode {
                background: #fefae0 !important;
                color: #222 !important;
                line-height: 1.9;
                font-size: 1.15rem;
            }
        </style>

        <script>
            document.getElementById("readingModeBtn").addEventListener("click", () => {
                document.body.classList.toggle("reading-mode");
                showNotification("Reading Mode toggled", "info");
            });
        </script>

        <!-- Wave Animation Background -->
        <canvas id="waveCanvas"></canvas>

        <style>
            #waveCanvas {
                position: fixed;
                bottom: 0;
                left: 0;
                width: 100%;
                height: 200px;
                z-index: -1;
            }
        </style>

        <script>
            const waveCanvas = document.getElementById("waveCanvas");
            const waveCtx = waveCanvas.getContext("2d");
            waveCanvas.width = window.innerWidth;
            waveCanvas.height = 200;

            function drawWaves() {
                waveCtx.clearRect(0, 0, waveCanvas.width, waveCanvas.height);
                waveCtx.fillStyle = "rgba(113,88,226,0.3)";
                waveCtx.beginPath();
                for (let x = 0; x < waveCanvas.width; x++) {
                    const y = 100 + Math.sin(x * 0.02 + Date.now() * 0.002) * 20;
                    waveCtx.lineTo(x, y);
                }
                waveCtx.lineTo(waveCanvas.width, waveCanvas.height);
                waveCtx.lineTo(0, waveCanvas.height);
                waveCtx.closePath();
                waveCtx.fill();
            }
            setInterval(drawWaves, 30);
        </script>

        <!-- Control Panel -->
        <div id="control-panel" class="control-panel">
            <h4><i class="fas fa-cogs"></i> Control Panel</h4>
            <button onclick="document.body.setAttribute('data-theme','light')">Light</button>
            <button onclick="document.body.setAttribute('data-theme','dark')">Dark</button>
            <button onclick="document.body.setAttribute('data-theme','space')">Space</button>
            <button onclick="toggleSteam()">‚òï Toggle Steam</button>
        </div>

        <style>
            .control-panel {
                position: fixed;
                top: 200px;
                left: -220px;
                width: 200px;
                background: var(--card-bg);
                border: 1px solid var(--border-color);
                padding: 15px;
                border-radius: 12px;
                box-shadow: var(--shadow);
                transition: left 0.4s;
                z-index: 1600;
            }
            .control-panel:hover {
                left: 20px;
            }
            .control-panel h4 {
                font-size: 1rem;
                margin-bottom: 10px;
            }
            .control-panel button {
                display: block;
                margin: 8px 0;
                padding: 6px 12px;
                border: none;
                border-radius: 6px;
                cursor: pointer;
                width: 100%;
                font-size: 0.9rem;
                background: linear-gradient(135deg, var(--neon-blue), var(--space-purple));
                color: white;
            }
        </style>

        <script>
            function toggleSteam() {
                const steam = document.querySelectorAll(".steam");
                steam.forEach(s => {
                    if (s.style.display === "none") {
                        s.style.display = "block";
                    } else {
                        s.style.display = "none";
                    }
                });
                showNotification("Steam toggled", "info");
            }
        </script>

        <!-- Keyboard Sound Effect -->
        <audio id="key-sound" src="https://freesound.org/data/previews/256/256113_3263906-lq.mp3"></audio>

        <script>
            document.addEventListener("keypress", () => {
                const sound = document.getElementById("key-sound");
                sound.currentTime = 0;
                sound.play();
            });
        </script>

        <!-- Glow Cursor -->
        <div id="cursor-glow"></div>

        <style>
            #cursor-glow {
                position: fixed;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: radial-gradient(circle, rgba(24,220,255,0.6), transparent 70%);
                pointer-events: none;
                mix-blend-mode: screen;
                z-index: 2000;
                transform: translate(-50%, -50%);
            }
        </style>

        <script>
            const glow = document.getElementById("cursor-glow");
            document.addEventListener("mousemove", (e) => {
                glow.style.top = e.clientY + "px";
                glow.style.left = e.clientX + "px";
            });
        </script>

        <!-- ================= END EXTRA FEATURES PART 4 ================= -->
        <!-- ================= EXTRA FEATURES PART 5 ================= -->
        <!-- Rain Effect -->
        <canvas id="rainCanvas"></canvas>

        <style>
            #rainCanvas {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: -3;
                pointer-events: none;
            }
        </style>

        <script>
            const rainCanvas = document.getElementById("rainCanvas");
            const rainCtx = rainCanvas.getContext("2d");
            rainCanvas.width = window.innerWidth;
            rainCanvas.height = window.innerHeight;

            const drops = [];
            for (let i = 0; i < 150; i++) {
                drops.push({
                    x: Math.random() * rainCanvas.width,
                    y: Math.random() * rainCanvas.height,
                    length: Math.random() * 20 + 10,
                    speed: Math.random() * 4 + 2
                });
            }

            function drawRain() {
                rainCtx.clearRect(0, 0, rainCanvas.width, rainCanvas.height);
                rainCtx.strokeStyle = "rgba(24,220,255,0.5)";
                rainCtx.lineWidth = 1;
                for (let d of drops) {
                    rainCtx.beginPath();
                    rainCtx.moveTo(d.x, d.y);
                    rainCtx.lineTo(d.x, d.y + d.length);
                    rainCtx.stroke();
                    d.y += d.speed;
                    if (d.y > rainCanvas.height) d.y = -20;
                }
            }
            setInterval(drawRain, 30);
        </script>

        <!-- Matrix Effect -->
        <canvas id="matrixCanvas"></canvas>

        <style>
            #matrixCanvas {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: -4;
                pointer-events: none;
                opacity: 0.3;
            }
        </style>

        <script>
            const matrixCanvas = document.getElementById("matrixCanvas");
            const matrixCtx = matrixCanvas.getContext("2d");
            matrixCanvas.width = window.innerWidth;
            matrixCanvas.height = window.innerHeight;

            const letters = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            const fontSize = 14;
            const columns = matrixCanvas.width / fontSize;
            const dropsM = [];
            for (let i = 0; i < columns; i++) dropsM[i] = 1;

            function drawMatrix() {
                matrixCtx.fillStyle = "rgba(0, 0, 0, 0.05)";
                matrixCtx.fillRect(0, 0, matrixCanvas.width, matrixCanvas.height);
                matrixCtx.fillStyle = "#0f0";
                matrixCtx.font = fontSize + "px monospace";
                for (let i = 0; i < dropsM.length; i++) {
                    const text = letters[Math.floor(Math.random() * letters.length)];
                    matrixCtx.fillText(text, i * fontSize, dropsM[i] * fontSize);
                    if (dropsM[i] * fontSize > matrixCanvas.height && Math.random() > 0.975) {
                        dropsM[i] = 0;
                    }
                    dropsM[i]++;
                }
            }
            setInterval(drawMatrix, 50);
        </script>

        <!-- Typing Counter -->
        <div id="typing-counter" class="typing-counter">
            Keys typed: <span id="keys-count">0</span>
        </div>

        <style>
            .typing-counter {
                position: fixed;
                bottom: 20px;
                right: 300px;
                background: var(--card-bg);
                border: 1px solid var(--border-color);
                border-radius: 12px;
                padding: 8px 15px;
                box-shadow: var(--shadow);
                font-size: 0.9rem;
                color: var(--text-primary);
                z-index: 1100;
            }
        </style>

        <script>
            let keyCount = 0;
            document.addEventListener("keydown", () => {
                keyCount++;
                document.getElementById("keys-count").textContent = keyCount;
            });
        </script>

        <!-- Zen Mode -->
        <button id="zenBtn" class="zen-btn"><i class="fas fa-yin-yang"></i></button>

        <style>
            .zen-btn {
                position: fixed;
                bottom: 230px;
                right: 30px;
                width: 55px;
                height: 55px;
                border-radius: 50%;
                background: linear-gradient(135deg, #18dcff, #7158e2);
                color: white;
                border: none;
                font-size: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                z-index: 1300;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            }
            body.zen-mode {
                background: radial-gradient(circle, #222 0%, #000 100%) !important;
                color: #eee !important;
                font-size: 1.2rem;
                line-height: 2;
            }
        </style>

        <script>
            document.getElementById("zenBtn").addEventListener("click", () => {
                document.body.classList.toggle("zen-mode");
                showNotification("Zen Mode toggled üßò", "info");
            });
        </script>

        <!-- ================= END EXTRA FEATURES PART 5 ================= -->
            <!-- ================= NEW FEATURE: 3D COFFEE CUP ================= -->
        <section id="coffee-3d" style="margin:60px 0; text-align:center;">
            <h2 style="color:var(--text-primary); margin-bottom:20px;">‚òï 3D Coffee Cup</h2>
            <div id="three-container" style="width:100%; height:500px;"></div>
        </section>

        <!-- Three.js Library -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

        <script>
            const container = document.getElementById("three-container");
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, container.clientWidth/container.clientHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);

            // Lighting
            const light = new THREE.PointLight(0xffffff, 1, 100);
            light.position.set(10, 10, 10);
            scene.add(light);

            // Cup (Cylinder + Torus as handle)
            const material = new THREE.MeshPhongMaterial({ color: 0x8B4513, shininess: 100 });
            const cup = new THREE.Mesh(new THREE.CylinderGeometry(2, 2, 4, 32, 1, false), material);
            scene.add(cup);

            // Handle
            const handle = new THREE.Mesh(new THREE.TorusGeometry(1.2, 0.3, 16, 100, Math.PI), material);
            handle.position.set(2.5, 0, 0);
            handle.rotation.z = Math.PI / 2;
            scene.add(handle);

            // Coffee surface
            const coffeeMat = new THREE.MeshPhongMaterial({ color: 0x3e2723 });
            const coffeeSurface = new THREE.Mesh(new THREE.CircleGeometry(2, 32), coffeeMat);
            coffeeSurface.rotation.x = -Math.PI / 2;
            coffeeSurface.position.y = 2;
            scene.add(coffeeSurface);

            // Floor
            const floor = new THREE.Mesh(new THREE.PlaneGeometry(20,20), new THREE.MeshPhongMaterial({color:0x444}));
            floor.rotation.x = -Math.PI/2;
            floor.position.y = -2;
            scene.add(floor);

            camera.position.z = 8;
            camera.position.y = 3;

            // Controls
            const controls = new THREE.OrbitControls(camera, renderer.domElement);

            // Animate
            function animate() {
                requestAnimationFrame(animate);
                cup.rotation.y += 0.003;
                handle.rotation.y += 0.003;
                coffeeSurface.rotation.z += 0.001;
                renderer.render(scene, camera);
            }
            animate();

            window.addEventListener("resize", () => {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            });
        </script>
        <!-- ================= END 3D COFFEE CUP ================= -->
                <!-- ================= END VISITOR CHAT ROOM ================= -->
                  <!-- Contact Page Modal -->
        <div id="contact-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:2000;justify-content:center;align-items:center;">
            <div style="background:var(--card-bg);border-radius:16px;padding:30px;width:90%;max-width:500px;box-shadow:var(--shadow);position:relative;">
                <h3 style="color:var(--text-primary);margin-bottom:20px;">üì© Contact for Advertisement</h3>
                <p style="margin-bottom:10px;"><b>WhatsApp:</b> <a href="https://wa.me/966500000000" target="_blank" style="color:var(--neon-green)">+966 50 000 0000</a></p>
                <p style="margin-bottom:20px;"><b>Email:</b> <a href="mailto:ads@coffeefinder.sa" style="color:var(--neon-blue)">ads@coffeefinder.sa</a></p>
                
                <form onsubmit="sendAdRequest(event)">
                    <input type="text" id="ad-name" placeholder="Your Name" required style="width:100%;padding:10px;margin-bottom:10px;border-radius:8px;border:1px solid var(--border-color);">
                    <textarea id="ad-message" placeholder="Your Message..." required style="width:100%;padding:10px;margin-bottom:10px;border-radius:8px;border:1px solid var(--border-color);height:100px;"></textarea>
                    <button type="submit" style="padding:10px 20px;border:none;border-radius:10px;background:linear-gradient(135deg,var(--neon-blue),var(--space-purple));color:white;cursor:pointer;">Send</button>
                </form>

                <button onclick="closeContact()" style="position:absolute;top:15px;right:15px;border:none;background:none;color:var(--text-secondary);font-size:20px;cursor:pointer;">‚úñ</button>
            </div>
        </div>

        <script>
            function openContact(){
                document.getElementById("contact-modal").style.display="flex";
            }
            function closeContact(){
                document.getElementById("contact-modal").style.display="none";
            }
            function sendAdRequest(e){
                e.preventDefault();
                const name=document.getElementById("ad-name").value;
                const msg=document.getElementById("ad-message").value;
                alert(`Thanks ${name}, your request has been sent!\nMessage: ${msg}`);
                closeContact();
            }
        </script>
        <!-- =============== END ADVERTISEMENT SYSTEM =============== -->
        <!-- =============== NEW FEATURE: APP DOWNLOAD + FOOTER =============== -->
        <footer style="margin-top:80px;background:var(--header-bg);padding:40px 20px;text-align:center;border-radius:16px;box-shadow:var(--shadow);">
            <h3 style="color:white;margin-bottom:20px;">üì≤ Get the Coffee Finder Pro App</h3>
            <div style="display:flex;gap:20px;justify-content:center;flex-wrap:wrap;margin-bottom:30px;">
                <a href="#" style="display:flex;align-items:center;gap:10px;padding:12px 20px;background:black;color:white;border-radius:10px;text-decoration:none;box-shadow:0 4px 15px rgba(0,0,0,0.3);">
                    <i class="fab fa-apple fa-2x"></i>
                    <div style="text-align:left;">
                        <small>Download on the</small><br>
                        <strong>App Store</strong>
                    </div>
                </a>
                <a href="#" style="display:flex;align-items:center;gap:10px;padding:12px 20px;background:#2ecc71;color:white;border-radius:10px;text-decoration:none;box-shadow:0 4px 15px rgba(0,0,0,0.3);">
                    <i class="fab fa-google-play fa-2x"></i>
                    <div style="text-align:left;">
                        <small>Get it on</small><br>
                        <strong>Google Play</strong>
                    </div>
                </a>
            </div>

            <p style="color:white;margin-bottom:10px;">¬© 2025 Coffee Finder Pro ‚Äî All Rights Reserved</p>
            <p style="color:white;margin-bottom:20px;">‚òï Made with ‚ù§Ô∏è in Saudi Arabia</p>
            
            <div style="display:flex;gap:15px;justify-content:center;flex-wrap:wrap;">
                <a href="#privacy" style="color:var(--neon-blue);text-decoration:none;">Privacy Policy</a>
                <a href="#terms" style="color:var(--neon-green);text-decoration:none;">Terms of Service</a>
                <a href="#contact" style="color:var(--neon-pink);text-decoration:none;">Contact Us</a>
            </div>
        </footer>
        <!-- =============== END FOOTER =============== -->
                       <!-- Ads Chart -->
                <div style="background:var(--card-bg);padding:20px;border-radius:16px;box-shadow:var(--shadow);width:100%;max-width:500px;">
                    <h4 style="color:var(--neon-green);margin-bottom:10px;">Ads Requests</h4>
                    <canvas id="adsChart" height="200"></canvas>
                </div>
            </div>
        </section>

        <!-- Chart.js CDN -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            // Visitors Chart
            const ctx1 = document.getElementById('visitorsChart').getContext('2d');
            new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: ['Jan','Feb','Mar','Apr','May','Jun','Jul'],
                    datasets: [{
                        label: 'Visitors',
                        data: [500,800,1200,900,1500,2000,2500],
                        borderColor: '#18dcff',
                        backgroundColor: 'rgba(24,220,255,0.2)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: { responsive:true, plugins:{legend:{labels:{color:'white'}}}, scales:{x:{ticks:{color:'white'}},y:{ticks:{color:'white'}}}}
            });

            // Ratings Chart
            const ctx2 = document.getElementById('ratingsChart').getContext('2d');
            new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: ['Arabica','Starbucks','Deem','Kai','Riche'],
                    datasets: [{
                        label: 'Avg Rating',
                        data: [4.5,4.7,4.3,4.6,4.8],
                        backgroundColor: ['#ff4d8d','#18dcff','#ffd166','#00ff8c','#7158e2']
                    }]
                },
                options: { responsive:true, plugins:{legend:{labels:{color:'white'}}}, scales:{x:{ticks:{color:'white'}},y:{ticks:{color:'white'}}}}
            });

            // Ads Chart
            const ctx3 = document.getElementById('adsChart').getContext('2d');
            new Chart(ctx3, {
                type: 'doughnut',
                data: {
                    labels: ['Pending','Approved','Rejected'],
                    datasets: [{
                        label: 'Ads Requests',
                        data: [5,12,3],
                        backgroundColor: ['#ffd166','#00ff8c','#ff6b6b']
                    }]
                },
                options: { responsive:true, plugins:{legend:{labels:{color:'white'}}}}
            });
        </script>
        <!-- =============== END DASHBOARD =============== -->
