<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coffee Finder Pro (OSM)</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    body { margin:0; font-family: Arial, sans-serif; display:flex; flex-direction:column; height:100vh; }
    header { background:#3c2f2f; color:#fff; padding:1rem; text-align:center; }
    #searchBar { display:flex; padding:1rem; gap:0.5rem; background:#fafafa; }
    #searchBar input { flex:1; padding:0.6rem; border:1px solid #ccc; border-radius:4px; }
    #searchBar button { background:#3c2f2f; color:#fff; border:none; padding:0.6rem 1.2rem; border-radius:4px; cursor:pointer; }
    #searchBar button:hover { background:#5a4444; }
    #container { flex:1; display:flex; }
    #map { flex:2; }
    #results { flex:1; overflow-y:auto; border-left:1px solid #ccc; padding:1rem; background:#fff; }
    .place { margin-bottom:1rem; padding-bottom:1rem; border-bottom:1px solid #eee; }
    .place h3 { margin:0; font-size:1.1rem; }
    .place p { margin:0.2rem 0; color:#555; }
  </style>
</head>
<body>
  <header>
    <h1>‚òï Coffee Finder Pro</h1>
    <p>Find caf√©s anywhere in the world üåç (Powered by OpenStreetMap)</p>
  </header>

  <div id="searchBar">
    <input type="text" id="locationInput" placeholder="Enter city, country (e.g. Riyadh, Saudi Arabia)">
    <button onclick="searchCoffee()">Search</button>
  </div>

  <div id="container">
    <div id="map"></div>
    <div id="results"><h2>Results</h2><div id="list"></div></div>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Init map
    const map = L.map('map').setView([20, 0], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);

    let markers = [];

    async function searchCoffee() {
      const location = document.getElementById("locationInput").value;
      if (!location) { alert("Please enter a city and country!"); return; }

      // 1. Geocode city + country ‚Üí coordinates
      const geoRes = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location)}`);
      const geoData = await geoRes.json();
      if (geoData.length === 0) {
        alert("Location not found.");
        return;
      }
      const { lat, lon } = geoData[0];
      map.setView([lat, lon], 14);

      // Clear old markers
      markers.forEach(m => map.removeLayer(m));
      markers = [];

      // 2. Query Overpass API for caf√©s around 3km
      const query = `
        [out:json];
        node["amenity"="cafe"](around:3000,${lat},${lon});
        out;
      `;
      const overRes = await fetch("https://overpass-api.de/api/interpreter", {
        method: "POST",
        body: query
      });
      const overData = await overRes.json();

      const listDiv = document.getElementById("list");
      listDiv.innerHTML = "";

      if (overData.elements.length === 0) {
        listDiv.innerHTML = "<p>No caf√©s found nearby.</p>";
        return;
      }

      // 3. Add markers + sidebar list
      overData.elements.forEach(place => {
        const name = place.tags.name || "Unnamed Caf√©";
        const marker = L.marker([place.lat, place.lon]).addTo(map)
          .bindPopup(`<b>${name}</b>`);
        markers.push(marker);

        const div = document.createElement("div");
        div.className = "place";
        div.innerHTML = `
          <h3>${name}</h3>
          <p>Lat: ${place.lat}, Lon: ${place.lon}</p>
          <a href="https://www.google.com/maps/dir/?api=1&destination=${place.lat},${place.lon}" target="_blank">üìç Get Directions</a>
        `;
        listDiv.appendChild(div);
      });
    }
  </script>
</body>
</html>
